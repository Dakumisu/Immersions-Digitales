/*
 Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
  Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
 Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with tiny-inflate 
  (https://github.com/foliojs/tiny-inflate) for use in Troika text rendering. 
  Original licenses apply: 
  - tiny-inflate: https://github.com/foliojs/tiny-inflate/blob/master/LICENSE (MIT)
  - woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/
'use strict';(function(B,z){"object"===typeof exports&&"undefined"!==typeof module?z(exports,require("three"),require("troika-worker-utils"),require("troika-three-utils")):"function"===typeof define&&define.amd?define(["exports","three","troika-worker-utils","troika-three-utils"],z):(B=B||self,z(B.troika_three_text={},B.THREE,B.troika_worker_utils,B.troika_three_utils))})(this,function(B,z,H,ca){function da(n,f){ja=!0;n=ka({},n);n.font=ra(n.font||L.defaultFontURL);n.text=""+n.text;n.sdfGlyphSize=
n.sdfGlyphSize||L.sdfGlyphSize;if(null!=n.colorRanges){var w={};for(c in n.colorRanges)if(n.colorRanges.hasOwnProperty(c)){var y=n.colorRanges[c];"number"!==typeof y&&(y=sa.set(y).getHex());w[c]=y}n.colorRanges=w}Object.freeze(n);w=L.textureWidth;var b=L.sdfExponent,a=n.sdfGlyphSize;var c=n.font+"@"+a;var d=la[c];d||(d=la[c]={sdfTexture:new z.DataTexture(new Uint8Array(a*w),w,a,z.LuminanceFormat,void 0,void 0,void 0,void 0,z.LinearFilter,z.LinearFilter)},d.sdfTexture.font=n.font);ta(n).then(function(c){c.newGlyphSDFs&&
(c.newGlyphSDFs.forEach(function(b){var c=b.textureData,e=b.atlasIndex;for(b=d.sdfTexture.image;b.data.length<(e+1)*a*a;){var g=new Uint8Array(2*b.data.length);g.set(b.data);b.data=g;b.height*=2}g=b.width/a;e=b.width*a*Math.floor(e/g)+e%g*a;for(g=0;g<a;g++)for(var f=g*a,u=e+g*b.width,q=0;q<a;q++)b.data[u+q]=c[f+q]}),d.sdfTexture.needsUpdate=!0);f(Object.freeze({parameters:n,sdfTexture:d.sdfTexture,sdfGlyphSize:a,sdfExponent:b,glyphBounds:c.glyphBounds,glyphAtlasIndices:c.glyphAtlasIndices,glyphColors:c.glyphColors,
caretPositions:c.caretPositions,caretHeight:c.caretHeight,chunkedBounds:c.chunkedBounds,ascender:c.ascender,descender:c.descender,lineHeight:c.lineHeight,topBaseline:c.topBaseline,blockBounds:c.blockBounds,visibleBounds:c.visibleBounds,timings:c.timings,get totalBounds(){console.log("totalBounds deprecated, use blockBounds instead");return c.blockBounds},get totalBlockSize(){console.log("totalBlockSize deprecated, use blockBounds instead");var a=c.blockBounds;return[a[2]-a[0],a[3]-a[1]]}}))})}function ka(n,
f){for(var w in f)f.hasOwnProperty(w)&&(n[w]=f[w]);return n}function ra(n){U||(U="undefined"===typeof document?{}:document.createElement("a"));U.href=n;return U.href}function ma(n){n=ca.createDerivedMaterial(n,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new z.Vector2},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new z.Vector4(0,0,0,0)},uTroikaClipRect:{value:new z.Vector4(0,0,0,0)},uTroikaDistanceOffset:{value:0},
uTroikaOrient:{value:new z.Matrix3},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:"\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform vec4 uTroikaTotalBounds;\nuniform vec4 uTroikaClipRect;\nuniform mat3 uTroikaOrient;\nuniform bool uTroikaUseGlyphColors;\nuniform float uTroikaDistanceOffset;\nattribute vec4 aTroikaGlyphBounds;\nattribute float aTroikaGlyphIndex;\nattribute vec3 aTroikaGlyphColor;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying vec3 vTroikaGlyphColor;\nvarying vec2 vTroikaGlyphDimensions;\n",
vertexTransform:"\nvec4 bounds = aTroikaGlyphBounds;\nvec4 outlineBounds = vec4(bounds.xy - uTroikaDistanceOffset, bounds.zw + uTroikaDistanceOffset);\nvec4 clippedBounds = vec4(\n  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),\n  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)\n);\nvec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);\n\nposition.xy = mix(bounds.xy, bounds.zw, clippedXY);\n\nuv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);\n\nposition = uTroikaOrient * position;\nnormal = uTroikaOrient * normal;\n\nvTroikaGlyphUV = clippedXY.xy;\nvTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);\n\n\nfloat txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;\nvec2 txUvPerGlyph = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;\nvec2 txStartUV = txUvPerGlyph * vec2(\n  mod(aTroikaGlyphIndex, txCols),\n  floor(aTroikaGlyphIndex / txCols)\n);\nvTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerGlyph);\n",
fragmentDefs:"\nuniform sampler2D uTroikaSDFTexture;\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform float uTroikaSDFExponent;\nuniform float uTroikaDistanceOffset;\nuniform bool uTroikaSDFDebug;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying vec2 vTroikaGlyphDimensions;\n\nfloat troikaSdfValueToSignedDistance(float alpha) {\n  // Inverse of encoding in SDFGenerator.js\n  \n  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);\n  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;\n  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);\n  return signedDist;\n}\n\nfloat troikaGlyphUvToSdfValue(vec2 glyphUV) {\n  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);\n  return texture2D(uTroikaSDFTexture, textureUV).r;\n}\n\nfloat troikaGlyphUvToDistance(vec2 uv) {\n  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));\n}\n\nfloat troikaGetTextAlpha(float distanceOffset) {\n  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);\n  float distance = troikaGlyphUvToDistance(clampedGlyphUV);\n    \n  // Extrapolate distance when outside bounds:\n  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : \n    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);\n\n  \n  \n  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)\n  float alpha = step(-distanceOffset, -distance);\n  #else\n  \n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  float aaDist = length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;\n  #else\n  float aaDist = vTroikaGlyphDimensions.x / 64.0;\n  #endif\n  \n  float alpha = smoothstep(\n    distanceOffset + aaDist,\n    distanceOffset - aaDist,\n    distance\n  );\n  #endif\n  \n  return alpha;\n}\n",
fragmentColorTransform:"\nfloat alpha = uTroikaSDFDebug ?\n  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :\n  troikaGetTextAlpha(uTroikaDistanceOffset);\n\n#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)\ngl_FragColor.a *= alpha;\n#endif\n  \nif (alpha == 0.0) {\n  discard;\n}\n",customRewriter:function(f){var n=f.vertexShader;f=f.fragmentShader;var y=/\buniform\s+vec3\s+diffuse\b/;y.test(f)&&(f=f.replace(y,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),
y.test(n)||(n=n.replace(ca.voidMainRegExp,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n")));return{vertexShader:n,fragmentShader:f}}});n.transparent=!0;Object.defineProperties(n,{isTroikaTextMaterial:{value:!0},shadowSide:{get:function(){return this.side},set:function(){}}});return n}function ua(n){var f=na.get(n);if(!f){var w=n.caretPositions,y=n.caretHeight;f=new Map;for(var b=0;b<w.length;b+=3){var a=w[b+2],c=f.get(a);c||f.set(a,
c=[]);c.push({x:w[b],y:a,height:y,charIndex:b/3});b+3>=w.length&&c.push({x:w[b+1],y:a,height:y,charIndex:b/3+1})}}na.set(n,f);return f}var S=H.defineWorkerModule({name:"Typr Font Parser",dependencies:[function(){return"undefined"==typeof window&&(self.window=self),function(n){var f={parse:function(b){var a=f._bin;b=new Uint8Array(b);if("ttcf"==a.readASCII(b,0,4)){var c=4;a.readUshort(b,c);c+=2;a.readUshort(b,c);c+=2;var d=a.readUint(b,c);c+=4;for(var e=[],g=0;g<d;g++){var h=a.readUint(b,c);c+=4;e.push(f._readFont(b,
h))}return e}return[f._readFont(b,0)]},_readFont:function(b,a){var c=f._bin,d=a;c.readFixed(b,a);a+=4;var e=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;var g="cmap;head;hhea;maxp;hmtx;name;OS/2;post;loca;glyf;kern;CFF ;GPOS;GSUB;SVG ".split(";");d={_data:b,_offset:d};for(var h={},k=0;k<e;k++){var l=c.readASCII(b,a,4);a+=4;c.readUint(b,a);a+=4;var m=c.readUint(b,a);a+=4;var u=c.readUint(b,a);a+=4;h[l]={offset:m,length:u}}for(k=0;k<g.length;k++)a=g[k],
h[a]&&(d[a.trim()]=f[a.trim()].parse(b,h[a].offset,h[a].length,d));return d},_tabOffset:function(b,a,c){var d=f._bin,e=d.readUshort(b,c+4);c+=12;for(var g=0;g<e;g++){var h=d.readASCII(b,c,4);c+=4;d.readUint(b,c);c+=4;var k=d.readUint(b,c);c+=4;d.readUint(b,c);if(c+=4,h==a)return k}return 0}};f._bin={readFixed:function(b,a){return(b[a]<<8|b[a+1])+(b[a+2]<<8|b[a+3])/65540},readF2dot14:function(b,a){return f._bin.readShort(b,a)/16384},readInt:function(b,a){var c=f._bin.t.uint8;return c[0]=b[a+3],c[1]=
b[a+2],c[2]=b[a+1],c[3]=b[a],f._bin.t.int32[0]},readInt8:function(b,a){return f._bin.t.uint8[0]=b[a],f._bin.t.int8[0]},readShort:function(b,a){var c=f._bin.t.uint8;return c[1]=b[a],c[0]=b[a+1],f._bin.t.int16[0]},readUshort:function(b,a){return b[a]<<8|b[a+1]},readUshorts:function(b,a,c){for(var d=[],e=0;e<c;e++)d.push(f._bin.readUshort(b,a+2*e));return d},readUint:function(b,a){var c=f._bin.t.uint8;return c[3]=b[a],c[2]=b[a+1],c[1]=b[a+2],c[0]=b[a+3],f._bin.t.uint32[0]},readUint64:function(b,a){return 4294967296*
f._bin.readUint(b,a)+f._bin.readUint(b,a+4)},readASCII:function(b,a,c){for(var d="",e=0;e<c;e++)d+=String.fromCharCode(b[a+e]);return d},readUnicode:function(b,a,c){for(var d="",e=0;e<c;e++){var g=b[a++]<<8|b[a++];d+=String.fromCharCode(g)}return d},_tdec:"undefined"!=typeof window&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(b,a,c){var d=f._bin._tdec;return d&&0==a&&c==b.length?d.decode(b):f._bin.readASCII(b,a,c)},readBytes:function(b,a,c){for(var d=[],e=0;e<c;e++)d.push(b[a+
e]);return d},readASCIIArray:function(b,a,c){for(var d=[],e=0;e<c;e++)d.push(String.fromCharCode(b[a+e]));return d}};f._bin.t={buff:new ArrayBuffer(8)};f._bin.t.int8=new Int8Array(f._bin.t.buff);f._bin.t.uint8=new Uint8Array(f._bin.t.buff);f._bin.t.int16=new Int16Array(f._bin.t.buff);f._bin.t.uint16=new Uint16Array(f._bin.t.buff);f._bin.t.int32=new Int32Array(f._bin.t.buff);f._bin.t.uint32=new Uint32Array(f._bin.t.buff);f._lctf={};f._lctf.parse=function(b,a,c,d,e){var g=f._bin;c={};d=a;g.readFixed(b,
a);a+=4;var h=g.readUshort(b,a);a+=2;var k=g.readUshort(b,a);a=g.readUshort(b,a+2);return c.scriptList=f._lctf.readScriptList(b,d+h),c.featureList=f._lctf.readFeatureList(b,d+k),c.lookupList=f._lctf.readLookupList(b,d+a,e),c};f._lctf.readLookupList=function(b,a,c){var d=f._bin,e=a,g=[],h=d.readUshort(b,a);a+=2;for(var k=0;k<h;k++){var l=d.readUshort(b,a);a+=2;l=f._lctf.readLookupTable(b,e+l,c);g.push(l)}return g};f._lctf.readLookupTable=function(b,a,c){var d=f._bin,e=a,g={tabs:[]};g.ltype=d.readUshort(b,
a);a+=2;g.flag=d.readUshort(b,a);a+=2;var h=d.readUshort(b,a);a+=2;for(var k=g.ltype,l=0;l<h;l++){var m=d.readUshort(b,a);a+=2;m=c(b,k,e+m,g);g.tabs.push(m)}return g};f._lctf.numOfOnes=function(b){for(var a=0,c=0;32>c;c++)0!=(b>>>c&1)&&a++;return a};f._lctf.readClassDef=function(b,a){var c=f._bin,d=[],e=c.readUshort(b,a);if(a+=2,1==e){var g=c.readUshort(b,a);a+=2;var h=c.readUshort(b,a);a+=2;for(var k=0;k<h;k++)d.push(g+k),d.push(g+k),d.push(c.readUshort(b,a)),a+=2}if(2==e)for(e=c.readUshort(b,a),
a+=2,k=0;k<e;k++)d.push(c.readUshort(b,a)),a+=2,d.push(c.readUshort(b,a)),a+=2,d.push(c.readUshort(b,a)),a+=2;return d};f._lctf.getInterval=function(b,a){for(var c=0;c<b.length;c+=3){var d=b[c],e=b[c+1];b[c+2];if(d<=a&&a<=e)return c}return-1};f._lctf.readCoverage=function(b,a){var c=f._bin,d={};d.fmt=c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);return a+=2,1==d.fmt&&(d.tab=c.readUshorts(b,a,e)),2==d.fmt&&(d.tab=c.readUshorts(b,a,3*e)),d};f._lctf.coverageIndex=function(b,a){var c=b.tab;return 1==
b.fmt?c.indexOf(a):2==b.fmt&&(b=f._lctf.getInterval(c,a),-1!=b)?c[b+2]+(a-c[b]):-1};f._lctf.readFeatureList=function(b,a){var c=f._bin,d=a,e=[],g=c.readUshort(b,a);a+=2;for(var h=0;h<g;h++){var k=c.readASCII(b,a,4);a+=4;var l=c.readUshort(b,a);a+=2;l=f._lctf.readFeatureTable(b,d+l);l.tag=k.trim();e.push(l)}return e};f._lctf.readFeatureTable=function(b,a){var c=f._bin,d=a,e={},g=c.readUshort(b,a);a+=2;0<g&&(e.featureParams=d+g);d=c.readUshort(b,a);a+=2;e.tab=[];for(g=0;g<d;g++)e.tab.push(c.readUshort(b,
a+2*g));return e};f._lctf.readScriptList=function(b,a){var c=f._bin,d=a,e={},g=c.readUshort(b,a);a+=2;for(var h=0;h<g;h++){var k=c.readASCII(b,a,4);a+=4;var l=c.readUshort(b,a);a+=2;e[k.trim()]=f._lctf.readScriptTable(b,d+l)}return e};f._lctf.readScriptTable=function(b,a){var c=f._bin,d=a,e={},g=c.readUshort(b,a);a+=2;e.default=f._lctf.readLangSysTable(b,d+g);g=c.readUshort(b,a);a+=2;for(var h=0;h<g;h++){var k=c.readASCII(b,a,4);a+=4;var l=c.readUshort(b,a);a+=2;e[k.trim()]=f._lctf.readLangSysTable(b,
d+l)}return e};f._lctf.readLangSysTable=function(b,a){var c=f._bin,d={};c.readUshort(b,a);a+=2;d.reqFeature=c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);return a+=2,d.features=c.readUshorts(b,a,e),d};f.CFF={};f.CFF.parse=function(b,a,c){var d=f._bin;(b=new Uint8Array(b.buffer,a,c))[a=0];b[++a];b[++a];b[++a];a++;var e=[];a=f.CFF.readIndex(b,a,e);var g=[];for(c=0;c<e.length-1;c++)g.push(d.readASCII(b,a+e[c],e[c+1]-e[c]));a+=e[e.length-1];e=[];a=f.CFF.readIndex(b,a,e);g=[];for(c=0;c<e.length-1;c++)g.push(f.CFF.readDict(b,
a+e[c],a+e[c+1]));a+=e[e.length-1];e=g[0];var h=[];a=f.CFF.readIndex(b,a,h);g=[];for(c=0;c<h.length-1;c++)g.push(d.readASCII(b,a+h[c],h[c+1]-h[c]));if(a+=h[h.length-1],f.CFF.readSubrs(b,a,e),e.CharStrings){a=e.CharStrings;h=[];a=f.CFF.readIndex(b,a,h);var k=[];for(c=0;c<h.length-1;c++)k.push(d.readBytes(b,a+h[c],h[c+1]-h[c]));e.CharStrings=k}if(e.ROS){a=e.FDArray;h=[];a=f.CFF.readIndex(b,a,h);e.FDArray=[];for(c=0;c<h.length-1;c++)k=f.CFF.readDict(b,a+h[c],a+h[c+1]),f.CFF._readFDict(b,k,g),e.FDArray.push(k);
a=e.FDSelect;e.FDSelect=[];c=b[a];if(a++,3!=c)throw c;h=d.readUshort(b,a);a+=2;for(c=0;c<h+1;c++)e.FDSelect.push(d.readUshort(b,a),b[a+2]),a+=3}return e.Encoding&&(e.Encoding=f.CFF.readEncoding(b,e.Encoding,e.CharStrings.length)),e.charset&&(e.charset=f.CFF.readCharset(b,e.charset,e.CharStrings.length)),f.CFF._readFDict(b,e,g),e};f.CFF._readFDict=function(b,a,c){var d,e;for(e in a.Private&&(d=a.Private[1],a.Private=f.CFF.readDict(b,d,d+a.Private[0]),a.Private.Subrs&&f.CFF.readSubrs(b,d+a.Private.Subrs,
a.Private)),a)-1!="FamilyName FontName FullName Notice version Copyright".split(" ").indexOf(e)&&(a[e]=c[a[e]-426+35])};f.CFF.readSubrs=function(b,a,c){var d=f._bin,e=[];a=f.CFF.readIndex(b,a,e);var g=e.length;c.Bias=1240>g?107:33900>g?1131:32768;c.Subrs=[];for(g=0;g<e.length-1;g++)c.Subrs.push(d.readBytes(b,a+e[g],e[g+1]-e[g]))};f.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,
34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,
0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0];f.CFF.glyphByUnicode=function(b,a){for(var c=0;c<b.charset.length;c++)if(b.charset[c]==a)return c;return-1};f.CFF.glyphBySE=function(b,a){return 0>a||255<a?-1:f.CFF.glyphByUnicode(b,f.CFF.tableSE[a])};f.CFF.readEncoding=function(b,a,c){f._bin;c=[".notdef"];var d=b[a];if(a++,0!=d)throw"error: unknown encoding format: "+d;d=b[a];a++;for(var e=0;e<d;e++)c.push(b[a+e]);return c};f.CFF.readCharset=function(b,a,c){var d=f._bin,e=[".notdef"],g=b[a];if(a++,0==
g)for(var h=0;h<c;h++){var k=d.readUshort(b,a);a+=2;e.push(k)}else{if(1!=g&&2!=g)throw"error: format: "+g;for(;e.length<c;){k=d.readUshort(b,a);a+=2;var l=0;1==g?(l=b[a],a++):(l=d.readUshort(b,a),a+=2);for(h=0;h<=l;h++)e.push(k),k++}}return e};f.CFF.readIndex=function(b,a,c){var d=f._bin,e=d.readUshort(b,a)+1,g=b[a+=2];if(a++,1==g)for(var h=0;h<e;h++)c.push(b[a+h]);else if(2==g)for(h=0;h<e;h++)c.push(d.readUshort(b,a+2*h));else if(3==g)for(h=0;h<e;h++)c.push(16777215&d.readUint(b,a+3*h-1));else if(1!=
e)throw"unsupported offset size: "+g+", count: "+e;return a+e*g-1};f.CFF.getCharString=function(b,a,c){var d=f._bin,e=b[a],g=b[a+1],h=(b[a+2],b[a+3],b[a+4],1),k=null,l=null;20>=e&&(k=e,h=1);12==e&&(k=100*e+g,h=2);21<=e&&27>=e&&(k=e,h=1);28==e&&(l=d.readShort(b,a+1),h=3);29<=e&&31>=e&&(k=e,h=1);32<=e&&246>=e&&(l=e-139,h=1);247<=e&&250>=e&&(l=256*(e-247)+g+108,h=2);251<=e&&254>=e&&(l=256*-(e-251)-g-108,h=2);255==e&&(l=d.readInt(b,a+1)/65535,h=5);c.val=null!=l?l:"o"+k;c.size=h};f.CFF.readCharString=
function(b,a,c){c=a+c;for(var d=f._bin,e=[];a<c;){var g=b[a],h=b[a+1],k=(b[a+2],b[a+3],b[a+4],1),l=null,m=null;20>=g&&(l=g,k=1);12==g&&(l=100*g+h,k=2);19!=g&&20!=g||(l=g,k=2);21<=g&&27>=g&&(l=g,k=1);28==g&&(m=d.readShort(b,a+1),k=3);29<=g&&31>=g&&(l=g,k=1);32<=g&&246>=g&&(m=g-139,k=1);247<=g&&250>=g&&(m=256*(g-247)+h+108,k=2);251<=g&&254>=g&&(m=256*-(g-251)-h-108,k=2);255==g&&(m=d.readInt(b,a+1)/65535,k=5);e.push(null!=m?m:"o"+l);a+=k}return e};f.CFF.readDict=function(b,a,c){for(var d=f._bin,e={},
g=[];a<c;){var h=b[a],k=b[a+1],l=(b[a+2],b[a+3],b[a+4],1),m=null,u=null;if(28==h&&(u=d.readShort(b,a+1),l=3),29==h&&(u=d.readInt(b,a+1),l=5),32<=h&&246>=h&&(u=h-139,l=1),247<=h&&250>=h&&(u=256*(h-247)+k+108,l=2),251<=h&&254>=h&&(u=256*-(h-251)-k-108,l=2),255==h)throw d.readInt(b,a+1),"unknown number";if(30==h){u=[];for(l=1;;){var q=b[a+l];l++;var t=q>>4;q&=15;if(15!=t&&u.push(t),15!=q&&u.push(q),15==q)break}t="";q=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"];for(var p=0;p<u.length;p++)t+=
q[u[p]];u=parseFloat(t)}21>=h&&(m="version Notice FullName FamilyName Weight FontBBox BlueValues OtherBlues FamilyBlues FamilyOtherBlues StdHW StdVW escape UniqueID XUID charset Encoding CharStrings Private Subrs defaultWidthX nominalWidthX".split(" ")[h],l=1,12==h)&&(m=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup",
"ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][k],l=2);null!=m?(e[m]=1==g.length?g[0]:g,g=[]):g.push(u);a+=l}return e};f.cmap={};f.cmap.parse=function(b,a,c){b=new Uint8Array(b.buffer,a,c);a=0;c=f._bin;var d={};c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;var g=[];d.tables=[];for(var h=0;h<e;h++){var k=c.readUshort(b,a);
a+=2;var l=c.readUshort(b,a);a+=2;var m=c.readUint(b,a);a+=4;var u="p"+k+"e"+l,q=g.indexOf(m);if(-1==q){var t;q=d.tables.length;g.push(m);var p=c.readUshort(b,m);0==p?t=f.cmap.parse0(b,m):4==p?t=f.cmap.parse4(b,m):6==p?t=f.cmap.parse6(b,m):12==p?t=f.cmap.parse12(b,m):console.debug("unknown format: "+p,k,l,m);d.tables.push(t)}if(null!=d[u])throw"multiple tables for one platform+encoding";d[u]=q}return d};f.cmap.parse0=function(b,a){var c=f._bin,d={};d.format=c.readUshort(b,a);a+=2;var e=c.readUshort(b,
a);a+=2;c.readUshort(b,a);a+=2;d.map=[];for(c=0;c<e-6;c++)d.map.push(b[a+c]);return d};f.cmap.parse4=function(b,a){var c=f._bin,d=a,e={};e.format=c.readUshort(b,a);a+=2;var g=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;var h=c.readUshort(b,a);a+=2;h/=2;e.searchRange=c.readUshort(b,a);a+=2;e.entrySelector=c.readUshort(b,a);a+=2;e.rangeShift=c.readUshort(b,a);a+=2;e.endCount=c.readUshorts(b,a,h);a=a+2*h+2;e.startCount=c.readUshorts(b,a,h);a+=2*h;e.idDelta=[];for(var k=0;k<h;k++)e.idDelta.push(c.readShort(b,
a)),a+=2;e.idRangeOffset=c.readUshorts(b,a,h);a+=2*h;for(e.glyphIdArray=[];a<d+g;)e.glyphIdArray.push(c.readUshort(b,a)),a+=2;return e};f.cmap.parse6=function(b,a){var c=f._bin,d={};d.format=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;d.firstCode=c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;d.glyphIdArray=[];for(var g=0;g<e;g++)d.glyphIdArray.push(c.readUshort(b,a)),a+=2;return d};f.cmap.parse12=function(b,a){var c=f._bin,d={};d.format=c.readUshort(b,a);a=a+2+2;c.readUint(b,
a);a+=4;c.readUint(b,a);a+=4;var e=c.readUint(b,a);a+=4;d.groups=[];for(var g=0;g<e;g++){var h=a+12*g,k=c.readUint(b,h+0),l=c.readUint(b,h+4);h=c.readUint(b,h+8);d.groups.push([k,l,h])}return d};f.glyf={};f.glyf.parse=function(b,a,c,d){b=[];for(a=0;a<d.maxp.numGlyphs;a++)b.push(null);return b};f.glyf._parseGlyf=function(b,a){var c=f._bin,d=b._data,e=f._tabOffset(d,"glyf",b._offset)+b.loca[a];if(b.loca[a]==b.loca[a+1])return null;b={};if(b.noc=c.readShort(d,e),e+=2,b.xMin=c.readShort(d,e),e+=2,b.yMin=
c.readShort(d,e),e+=2,b.xMax=c.readShort(d,e),e+=2,b.yMax=c.readShort(d,e),e+=2,b.xMin>=b.xMax||b.yMin>=b.yMax)return null;if(0<b.noc){b.endPts=[];for(a=0;a<b.noc;a++)b.endPts.push(c.readUshort(d,e)),e+=2;a=c.readUshort(d,e);if(e+=2,d.length-e<a)return null;b.instructions=c.readBytes(d,e,a);e+=a;var g=b.endPts[b.noc-1]+1;b.flags=[];for(a=0;a<g;a++){var h=d[e];if(e++,b.flags.push(h),0!=(8&h)){var k=d[e];e++;for(var l=0;l<k;l++)b.flags.push(h),a++}}b.xs=[];for(a=0;a<g;a++)h=0!=(2&b.flags[a]),k=0!=(16&
b.flags[a]),h?(b.xs.push(k?d[e]:-d[e]),e++):k?b.xs.push(0):(b.xs.push(c.readShort(d,e)),e+=2);b.ys=[];for(a=0;a<g;a++)h=0!=(4&b.flags[a]),k=0!=(32&b.flags[a]),h?(b.ys.push(k?d[e]:-d[e]),e++):k?b.ys.push(0):(b.ys.push(c.readShort(d,e)),e+=2);for(a=e=d=0;a<g;a++)d+=b.xs[a],e+=b.ys[a],b.xs[a]=d,b.ys[a]=e}else{b.parts=[];do a=c.readUshort(d,e),e+=2,g={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1},(b.parts.push(g),g.glyphIndex=c.readUshort(d,e),e+=2,1&a)?(h=c.readShort(d,e),e+=2,k=c.readShort(d,e),e+=2):
(h=c.readInt8(d,e),e++,k=c.readInt8(d,e),e++),2&a?(g.m.tx=h,g.m.ty=k):(g.p1=h,g.p2=k),8&a?(g.m.a=g.m.d=c.readF2dot14(d,e),e+=2):64&a?(g.m.a=c.readF2dot14(d,e),e+=2,g.m.d=c.readF2dot14(d,e),e+=2):128&a&&(g.m.a=c.readF2dot14(d,e),e+=2,g.m.b=c.readF2dot14(d,e),e+=2,g.m.c=c.readF2dot14(d,e),e+=2,g.m.d=c.readF2dot14(d,e),e+=2);while(32&a);if(256&a)for(c=c.readUshort(d,e),e+=2,b.instr=[],a=0;a<c;a++)b.instr.push(d[e]),e++}return b};f.GPOS={};f.GPOS.parse=function(b,a,c,d){return f._lctf.parse(b,a,c,d,f.GPOS.subt)};
f.GPOS.subt=function(b,a,c,d){var e=f._bin,g=c,h={};if(h.fmt=e.readUshort(b,c),c+=2,1==a||2==a||3==a||7==a||8==a&&2>=h.fmt){var k=e.readUshort(b,c);c+=2;h.coverage=f._lctf.readCoverage(b,k+g)}if(1==a&&1==h.fmt)d=e.readUshort(b,c),c+=2,f._lctf.numOfOnes(d),0!=d&&(h.pos=f.GPOS.readValueRecord(b,c,d));else if(2==a&&1<=h.fmt&&2>=h.fmt){d=e.readUshort(b,c);c+=2;k=e.readUshort(b,c);c+=2;a=f._lctf.numOfOnes(d);var l=f._lctf.numOfOnes(k);if(1==h.fmt){h.pairsets=[];var m=e.readUshort(b,c);c+=2;for(var u=0;u<
m;u++){var q=g+e.readUshort(b,c);c+=2;var t=e.readUshort(b,q);q+=2;for(var p=[],r=0;r<t;r++){var A=e.readUshort(b,q);q+=2;0!=d&&(x=f.GPOS.readValueRecord(b,q,d),q+=2*a);0!=k&&(n=f.GPOS.readValueRecord(b,q,k),q+=2*l);p.push({gid2:A,val1:x,val2:n})}h.pairsets.push(p)}}if(2==h.fmt)for(x=e.readUshort(b,c),c+=2,n=e.readUshort(b,c),c+=2,m=e.readUshort(b,c),c+=2,e=e.readUshort(b,c),c+=2,h.classDef1=f._lctf.readClassDef(b,g+x),h.classDef2=f._lctf.readClassDef(b,g+n),h.matrix=[],u=0;u<m;u++){g=[];for(r=0;r<
e;r++){var x=null,n=null;0!=d&&(x=f.GPOS.readValueRecord(b,c,d),c+=2*a);0!=k&&(n=f.GPOS.readValueRecord(b,c,k),c+=2*l);g.push({val1:x,val2:n})}h.matrix.push(g)}}else{if(9==a&&1==h.fmt){h=e.readUshort(b,c);c=e.readUint(b,c+2);if(9==d.ltype)d.ltype=h;else if(d.ltype!=h)throw"invalid extension substitution";return f.GPOS.subt(b,d.ltype,g+c)}console.debug("unsupported GPOS table LookupType",a,"format",h.fmt)}return h};f.GPOS.readValueRecord=function(b,a,c){var d=f._bin,e=[];return e.push(1&c?d.readShort(b,
a):0),a+=1&c?2:0,e.push(2&c?d.readShort(b,a):0),a+=2&c?2:0,e.push(4&c?d.readShort(b,a):0),a+=4&c?2:0,e.push(8&c?d.readShort(b,a):0),e};f.GSUB={};f.GSUB.parse=function(b,a,c,d){return f._lctf.parse(b,a,c,d,f.GSUB.subt)};f.GSUB.subt=function(b,a,c,d){var e=f._bin,g=c,h={};if(h.fmt=e.readUshort(b,c),c+=2,1!=a&&4!=a&&5!=a&&6!=a)return null;if(1==a||4==a||5==a&&2>=h.fmt||6==a&&2>=h.fmt){var k=e.readUshort(b,c);c+=2;h.coverage=f._lctf.readCoverage(b,g+k)}if(1==a&&1<=h.fmt&&2>=h.fmt)1==h.fmt?h.delta=e.readShort(b,
c):2==h.fmt&&(a=e.readUshort(b,c),h.newg=e.readUshorts(b,c+2,a));else if(4==a)for(h.vals=[],a=e.readUshort(b,c),c+=2,d=0;d<a;d++)k=e.readUshort(b,c),c+=2,h.vals.push(f.GSUB.readLigatureSet(b,g+k));else if(5==a&&2==h.fmt){if(2==h.fmt)for(d=e.readUshort(b,c),c+=2,h.cDef=f._lctf.readClassDef(b,g+d),h.scset=[],a=e.readUshort(b,c),c+=2,d=0;d<a;d++)k=e.readUshort(b,c),c+=2,h.scset.push(0==k?null:f.GSUB.readSubClassSet(b,g+k))}else if(6==a&&3==h.fmt){if(3==h.fmt){for(d=0;3>d;d++){a=e.readUshort(b,c);c+=
2;k=[];for(var l=0;l<a;l++)k.push(f._lctf.readCoverage(b,g+e.readUshort(b,c+2*l)));c+=2*a;0==d&&(h.backCvg=k);1==d&&(h.inptCvg=k);2==d&&(h.ahedCvg=k)}a=e.readUshort(b,c);h.lookupRec=f.GSUB.readSubstLookupRecords(b,c+2,a)}}else{if(7==a&&1==h.fmt){h=e.readUshort(b,c);c=e.readUint(b,c+2);if(9==d.ltype)d.ltype=h;else if(d.ltype!=h)throw"invalid extension substitution";return f.GSUB.subt(b,d.ltype,g+c)}console.debug("unsupported GSUB table LookupType",a,"format",h.fmt)}return h};f.GSUB.readSubClassSet=
function(b,a){var c=f._bin.readUshort,d=a,e=[],g=c(b,a);a+=2;for(var h=0;h<g;h++){var k=c(b,a);a+=2;e.push(f.GSUB.readSubClassRule(b,d+k))}return e};f.GSUB.readSubClassRule=function(b,a){var c=f._bin.readUshort,d={},e=c(b,a),g=c(b,a+=2);a+=2;d.input=[];for(var h=0;h<e-1;h++)d.input.push(c(b,a)),a+=2;return d.substLookupRecords=f.GSUB.readSubstLookupRecords(b,a,g),d};f.GSUB.readSubstLookupRecords=function(b,a,c){for(var d=f._bin.readUshort,e=[],g=0;g<c;g++)e.push(d(b,a),d(b,a+2)),a+=4;return e};f.GSUB.readChainSubClassSet=
function(b,a){var c=f._bin,d=a,e=[],g=c.readUshort(b,a);a+=2;for(var h=0;h<g;h++){var k=c.readUshort(b,a);a+=2;e.push(f.GSUB.readChainSubClassRule(b,d+k))}return e};f.GSUB.readChainSubClassRule=function(b,a){for(var c=f._bin,d={},e=["backtrack","input","lookahead"],g=0;g<e.length;g++){var h=c.readUshort(b,a);a+=2;1==g&&h--;d[e[g]]=c.readUshorts(b,a,h);a+=2*d[e[g]].length}h=c.readUshort(b,a);return a+=2,d.subst=c.readUshorts(b,a,2*h),d};f.GSUB.readLigatureSet=function(b,a){var c=f._bin,d=a,e=[],g=
c.readUshort(b,a);a+=2;for(var h=0;h<g;h++){var k=c.readUshort(b,a);a+=2;e.push(f.GSUB.readLigature(b,d+k))}return e};f.GSUB.readLigature=function(b,a){var c=f._bin,d={chain:[]};d.nglyph=c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;for(var g=0;g<e-1;g++)d.chain.push(c.readUshort(b,a)),a+=2;return d};f.head={};f.head.parse=function(b,a,c){c=f._bin;var d={};c.readFixed(b,a);a+=4;d.fontRevision=c.readFixed(b,a);a+=4;c.readUint(b,a);a+=4;c.readUint(b,a);return a+=4,d.flags=c.readUshort(b,a),a+=
2,d.unitsPerEm=c.readUshort(b,a),a+=2,d.created=c.readUint64(b,a),a+=8,d.modified=c.readUint64(b,a),a+=8,d.xMin=c.readShort(b,a),a+=2,d.yMin=c.readShort(b,a),a+=2,d.xMax=c.readShort(b,a),a+=2,d.yMax=c.readShort(b,a),a+=2,d.macStyle=c.readUshort(b,a),a+=2,d.lowestRecPPEM=c.readUshort(b,a),a+=2,d.fontDirectionHint=c.readShort(b,a),a+=2,d.indexToLocFormat=c.readShort(b,a),a+=2,d.glyphDataFormat=c.readShort(b,a),d};f.hhea={};f.hhea.parse=function(b,a,c){c=f._bin;var d={};c.readFixed(b,a);return a+=4,
d.ascender=c.readShort(b,a),a+=2,d.descender=c.readShort(b,a),a+=2,d.lineGap=c.readShort(b,a),a+=2,d.advanceWidthMax=c.readUshort(b,a),a+=2,d.minLeftSideBearing=c.readShort(b,a),a+=2,d.minRightSideBearing=c.readShort(b,a),a+=2,d.xMaxExtent=c.readShort(b,a),a+=2,d.caretSlopeRise=c.readShort(b,a),a+=2,d.caretSlopeRun=c.readShort(b,a),a+=2,d.caretOffset=c.readShort(b,a),a+=2,a+=8,d.metricDataFormat=c.readShort(b,a),a+=2,d.numberOfHMetrics=c.readUshort(b,a),d};f.hmtx={};f.hmtx.parse=function(b,a,c,d){c=
f._bin;for(var e={aWidth:[],lsBearing:[]},g=0,h=0,k=0;k<d.maxp.numGlyphs;k++)k<d.hhea.numberOfHMetrics&&(g=c.readUshort(b,a),a+=2,h=c.readShort(b,a),a+=2),e.aWidth.push(g),e.lsBearing.push(h);return e};f.kern={};f.kern.parse=function(b,a,c,d){var e=f._bin,g=e.readUshort(b,a);if(a+=2,1==g)return f.kern.parseV1(b,a-2,c,d);c=e.readUshort(b,a);a+=2;d={glyph1:[],rval:[]};for(g=0;g<c;g++){a+=2;e.readUshort(b,a);a+=2;var h=e.readUshort(b,a);a+=2;h>>>=8;if(0!=(h&=15))throw"unknown kern table format: "+h;
a=f.kern.readFormat0(b,a,d)}return d};f.kern.parseV1=function(b,a,c,d){c=f._bin;c.readFixed(b,a);a+=4;d=c.readUint(b,a);a+=4;for(var e={glyph1:[],rval:[]},g=0;g<d;g++){c.readUint(b,a);a+=4;var h=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;h>>>=8;if(0!=(h&=15))throw"unknown kern table format: "+h;a=f.kern.readFormat0(b,a,e)}return e};f.kern.readFormat0=function(b,a,c){var d=f._bin,e=-1,g=d.readUshort(b,a);a+=2;d.readUshort(b,a);a+=2;d.readUshort(b,a);a+=2;d.readUshort(b,a);a+=2;for(var h=0;h<g;h++){var k=
d.readUshort(b,a);a+=2;var l=d.readUshort(b,a);a+=2;var m=d.readShort(b,a);a+=2;k!=e&&(c.glyph1.push(k),c.rval.push({glyph2:[],vals:[]}));e=c.rval[c.rval.length-1];e.glyph2.push(l);e.vals.push(m);e=k}return a};f.loca={};f.loca.parse=function(b,a,c,d){c=f._bin;var e=[],g=d.head.indexToLocFormat;d=d.maxp.numGlyphs+1;if(0==g)for(var h=0;h<d;h++)e.push(c.readUshort(b,a+(h<<1))<<1);if(1==g)for(h=0;h<d;h++)e.push(c.readUint(b,a+(h<<2)));return e};f.maxp={};f.maxp.parse=function(b,a,c){c=f._bin;var d={},
e=c.readUint(b,a);return a+=4,d.numGlyphs=c.readUshort(b,a),a+=2,65536==e&&(d.maxPoints=c.readUshort(b,a),a+=2,d.maxContours=c.readUshort(b,a),a+=2,d.maxCompositePoints=c.readUshort(b,a),a+=2,d.maxCompositeContours=c.readUshort(b,a),a+=2,d.maxZones=c.readUshort(b,a),a+=2,d.maxTwilightPoints=c.readUshort(b,a),a+=2,d.maxStorage=c.readUshort(b,a),a+=2,d.maxFunctionDefs=c.readUshort(b,a),a+=2,d.maxInstructionDefs=c.readUshort(b,a),a+=2,d.maxStackElements=c.readUshort(b,a),a+=2,d.maxSizeOfInstructions=
c.readUshort(b,a),a+=2,d.maxComponentElements=c.readUshort(b,a),a+=2,d.maxComponentDepth=c.readUshort(b,a)),d};f.name={};f.name.parse=function(b,a,c){c=f._bin;var d={};c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;c.readUshort(b,a);for(var g,h="copyright fontFamily fontSubfamily ID fullName version postScriptName trademark manufacturer designer description urlVendor urlDesigner licence licenceURL --- typoFamilyName typoSubfamilyName compatibleFull sampleText postScriptCID wwsFamilyName wwsSubfamilyName lightPalette darkPalette".split(" "),
k=a+=2,l=0;l<e;l++){var m=c.readUshort(b,a);a+=2;var u=c.readUshort(b,a);a+=2;var q=c.readUshort(b,a);a+=2;var t=c.readUshort(b,a);a+=2;var p=c.readUshort(b,a);a+=2;var r=c.readUshort(b,a);a+=2;var A=h[t];r=k+12*e+r;if(0==m)p=c.readUnicode(b,r,p/2);else if(3==m&&0==u)p=c.readUnicode(b,r,p/2);else if(0==u)p=c.readASCII(b,r,p);else if(1==u)p=c.readUnicode(b,r,p/2);else if(3==u)p=c.readUnicode(b,r,p/2);else{if(1!=m)throw"unknown encoding "+u+", platformID: "+m;p=c.readASCII(b,r,p);console.debug("reading unknown MAC encoding "+
u+" as ASCII")}m="p"+m+","+q.toString(16);null==d[m]&&(d[m]={});d[m][void 0!==A?A:t]=p;d[m]._lang=q}for(var x in d)if(null!=d[x].postScriptName&&1033==d[x]._lang)return d[x];for(x in d)if(null!=d[x].postScriptName&&0==d[x]._lang)return d[x];for(x in d)if(null!=d[x].postScriptName&&3084==d[x]._lang)return d[x];for(x in d)if(null!=d[x].postScriptName)return d[x];for(x in d){g=x;break}return console.debug("returning name table with languageID "+d[g]._lang),d[g]};f["OS/2"]={};f["OS/2"].parse=function(b,
a,c){c=f._bin.readUshort(b,a);a+=2;var d={};if(0==c)f["OS/2"].version0(b,a,d);else if(1==c)f["OS/2"].version1(b,a,d);else if(2==c||3==c||4==c)f["OS/2"].version2(b,a,d);else{if(5!=c)throw"unknown OS/2 table version: "+c;f["OS/2"].version5(b,a,d)}return d};f["OS/2"].version0=function(b,a,c){var d=f._bin;return c.xAvgCharWidth=d.readShort(b,a),a+=2,c.usWeightClass=d.readUshort(b,a),a+=2,c.usWidthClass=d.readUshort(b,a),a+=2,c.fsType=d.readUshort(b,a),a+=2,c.ySubscriptXSize=d.readShort(b,a),a+=2,c.ySubscriptYSize=
d.readShort(b,a),a+=2,c.ySubscriptXOffset=d.readShort(b,a),a+=2,c.ySubscriptYOffset=d.readShort(b,a),a+=2,c.ySuperscriptXSize=d.readShort(b,a),a+=2,c.ySuperscriptYSize=d.readShort(b,a),a+=2,c.ySuperscriptXOffset=d.readShort(b,a),a+=2,c.ySuperscriptYOffset=d.readShort(b,a),a+=2,c.yStrikeoutSize=d.readShort(b,a),a+=2,c.yStrikeoutPosition=d.readShort(b,a),a+=2,c.sFamilyClass=d.readShort(b,a),a+=2,c.panose=d.readBytes(b,a,10),a+=10,c.ulUnicodeRange1=d.readUint(b,a),a+=4,c.ulUnicodeRange2=d.readUint(b,
a),a+=4,c.ulUnicodeRange3=d.readUint(b,a),a+=4,c.ulUnicodeRange4=d.readUint(b,a),a+=4,c.achVendID=[d.readInt8(b,a),d.readInt8(b,a+1),d.readInt8(b,a+2),d.readInt8(b,a+3)],a+=4,c.fsSelection=d.readUshort(b,a),a+=2,c.usFirstCharIndex=d.readUshort(b,a),a+=2,c.usLastCharIndex=d.readUshort(b,a),a+=2,c.sTypoAscender=d.readShort(b,a),a+=2,c.sTypoDescender=d.readShort(b,a),a+=2,c.sTypoLineGap=d.readShort(b,a),a+=2,c.usWinAscent=d.readUshort(b,a),a+=2,c.usWinDescent=d.readUshort(b,a),a+2};f["OS/2"].version1=
function(b,a,c){var d=f._bin;return a=f["OS/2"].version0(b,a,c),c.ulCodePageRange1=d.readUint(b,a),a+=4,c.ulCodePageRange2=d.readUint(b,a),a+4};f["OS/2"].version2=function(b,a,c){var d=f._bin;return a=f["OS/2"].version1(b,a,c),c.sxHeight=d.readShort(b,a),a+=2,c.sCapHeight=d.readShort(b,a),a+=2,c.usDefault=d.readUshort(b,a),a+=2,c.usBreak=d.readUshort(b,a),a+=2,c.usMaxContext=d.readUshort(b,a),a+2};f["OS/2"].version5=function(b,a,c){var d=f._bin;return a=f["OS/2"].version2(b,a,c),c.usLowerOpticalPointSize=
d.readUshort(b,a),a+=2,c.usUpperOpticalPointSize=d.readUshort(b,a),a+2};f.post={};f.post.parse=function(b,a,c){c=f._bin;var d={};return d.version=c.readFixed(b,a),a+=4,d.italicAngle=c.readFixed(b,a),a+=4,d.underlinePosition=c.readShort(b,a),a+=2,d.underlineThickness=c.readShort(b,a),d};f.SVG={};f.SVG.parse=function(b,a,c){c=f._bin;var d={entries:[]},e=a;c.readUshort(b,a);a+=2;var g=c.readUint(b,a);c.readUint(b,a+4);a=g+e;var h=c.readUshort(b,a);a+=2;for(var k=0;k<h;k++){var l=c.readUshort(b,a);a+=
2;var m=c.readUshort(b,a);a+=2;var u=c.readUint(b,a);a+=4;var q=c.readUint(b,a);a+=4;u=new Uint8Array(b.buffer,e+u+g,q);for(u=c.readUTF8(u,0,u.length);l<=m;l++)d.entries[l]=u}return d};f.SVG.toPath=function(b){var a={cmds:[],crds:[]};if(null==b)return a;for(var c=(new DOMParser).parseFromString(b,"image/svg+xml").firstChild;"svg"!=c.tagName;)c=c.nextSibling;b=(b=c.getAttribute("viewBox"))?b.trim().split(" ").map(parseFloat):[0,0,1E3,1E3];f.SVG._toPath(c.children,a);for(c=0;c<a.crds.length;c+=2){var d=
a.crds[c],e=a.crds[c+1];d-=b[0];e=-(e-=b[1]);a.crds[c]=d;a.crds[c+1]=e}return a};f.SVG._toPath=function(b,a,c){for(var d=0;d<b.length;d++){var e=b[d],g=e.tagName,h=e.getAttribute("fill");(null==h&&(h=c),"g"==g)?f.SVG._toPath(e.children,a,h):"path"==g?(a.cmds.push(h||"#000000"),e=e.getAttribute("d"),e=f.SVG._tokens(e),f.SVG._toksToPath(e,a),a.cmds.push("X")):"defs"==g||console.debug(g,e)}};f.SVG._tokens=function(b){for(var a=[],c=0,d=!1,e="";c<b.length;){var g=b.charCodeAt(c),f=b.charAt(c);c++;g=48<=
g&&57>=g||"."==f||"-"==f;d?"-"==f?(a.push(parseFloat(e)),e=f):g?e+=f:(a.push(parseFloat(e)),","!=f&&" "!=f&&a.push(f),d=!1):g?(e=f,d=!0):","!=f&&" "!=f&&a.push(f)}return d&&a.push(parseFloat(e)),a};f.SVG._toksToPath=function(b,a){var c=0,d=0,e=0,g=0,h=0,k={M:2,L:2,H:1,V:1,S:4,C:6},l=a.cmds;for(a=a.crds;c<b.length;){var m=b[c];if(c++,"z"==m)l.push("Z"),d=g,e=h;else for(var u=m.toUpperCase(),q=f.SVG._reps(b,c,k[u]),t=0;t<q;t++){var p=0,r=0;if(m!=u&&(p=d,r=e),"M"==u)d=p+b[c++],e=r+b[c++],l.push("M"),
a.push(d,e),g=d,h=e;else if("L"==u)d=p+b[c++],e=r+b[c++],l.push("L"),a.push(d,e);else if("H"==u)d=p+b[c++],l.push("L"),a.push(d,e);else if("V"==u)e=r+b[c++],l.push("L"),a.push(d,e);else if("C"==u){d=p+b[c++];e=r+b[c++];var A=p+b[c++],x=r+b[c++];p+=b[c++];r+=b[c++];l.push("C");a.push(d,e,A,x,p,r);d=p;e=r}else"S"==u?(A=Math.max(a.length-4,0),d=d+d-a[A],e=e+e-a[A+1],A=p+b[c++],x=r+b[c++],p+=b[c++],r+=b[c++],l.push("C"),a.push(d,e,A,x,p,r),d=p,e=r):console.debug("Unknown SVG command "+m)}}};f.SVG._reps=
function(b,a,c){for(var d=a;d<b.length&&"string"!=typeof b[d];)d+=c;return(d-a)/c};null==f&&(f={});null==f.U&&(f.U={});f.U.codeToGlyph=function(b,a){b=b.cmap;var c=-1;if(null!=b.p0e4?c=b.p0e4:null!=b.p3e1?c=b.p3e1:null!=b.p1e0?c=b.p1e0:null!=b.p0e3&&(c=b.p0e3),-1==c)throw"no familiar platform and encoding!";b=b.tables[c];if(0==b.format)return a>=b.map.length?0:b.map[a];if(4==b.format){var d=-1;for(c=0;c<b.endCount.length;c++)if(a<=b.endCount[c]){d=c;break}return-1==d||b.startCount[d]>a?0:65535&(0!=
b.idRangeOffset[d]?b.glyphIdArray[a-b.startCount[d]+(b.idRangeOffset[d]>>1)-(b.idRangeOffset.length-d)]:a+b.idDelta[d])}if(12==b.format){if(a>b.groups[b.groups.length-1][1])return 0;for(c=0;c<b.groups.length;c++)if(d=b.groups[c],d[0]<=a&&a<=d[1])return d[2]+(a-d[0]);return 0}throw"unknown cmap table format "+b.format;};f.U.glyphToPath=function(b,a){var c={cmds:[],crds:[]};if(b.SVG&&b.SVG.entries[a]){var d=b.SVG.entries[a];return null==d?c:("string"==typeof d&&(d=f.SVG.toPath(d),b.SVG.entries[a]=d),
d)}if(b.CFF){d={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:b.CFF.Private?b.CFF.Private.defaultWidthX:0,open:!1};var e=b.CFF,g=b.CFF.Private;if(e.ROS){for(g=0;e.FDSelect[g+2]<=a;)g+=2;g=e.FDArray[e.FDSelect[g+1]].Private}f.U._drawCFF(b.CFF.CharStrings[a],d,e,g,c)}else b.glyf&&f.U._drawGlyf(a,b,c);return c};f.U._drawGlyf=function(b,a,c){var d=a.glyf[b];null==d&&(d=a.glyf[b]=f.glyf._parseGlyf(a,b));null!=d&&(-1<d.noc?f.U._simpleGlyph(d,c):f.U._compoGlyph(d,a,c))};f.U._simpleGlyph=function(b,a){for(var c=
0;c<b.noc;c++){for(var d=0==c?0:b.endPts[c-1]+1,e=b.endPts[c],g=d;g<=e;g++){var h=g==d?e:g-1,k=g==e?d:g+1,l=1&b.flags[g],m=1&b.flags[h],u=1&b.flags[k],q=b.xs[g],t=b.ys[g];if(g==d)if(l){if(!m){f.U.P.moveTo(a,q,t);continue}f.U.P.moveTo(a,b.xs[h],b.ys[h])}else m?f.U.P.moveTo(a,b.xs[h],b.ys[h]):f.U.P.moveTo(a,(b.xs[h]+q)/2,(b.ys[h]+t)/2);l?m&&f.U.P.lineTo(a,q,t):u?f.U.P.qcurveTo(a,q,t,b.xs[k],b.ys[k]):f.U.P.qcurveTo(a,q,t,(q+b.xs[k])/2,(t+b.ys[k])/2)}f.U.P.closePath(a)}};f.U._compoGlyph=function(b,a,
c){for(var d=0;d<b.parts.length;d++){var e={cmds:[],crds:[]},g=b.parts[d];f.U._drawGlyf(g.glyphIndex,a,e);g=g.m;for(var h=0;h<e.crds.length;h+=2){var k=e.crds[h],l=e.crds[h+1];c.crds.push(k*g.a+l*g.b+g.tx);c.crds.push(k*g.c+l*g.d+g.ty)}for(h=0;h<e.cmds.length;h++)c.cmds.push(e.cmds[h])}};f.U._getGlyphClass=function(b,a){b=f._lctf.getInterval(a,b);return-1==b?0:a[b+2]};f.U.getPairAdjustment=function(b,a,c){var d=0;if(b.GPOS){var e=b.GPOS,g=e.lookupList;e=e.featureList;for(var h=[],k=0;k<e.length;k++){var l=
e[k];if("kern"==l.tag)for(var m=0;m<l.tab.length;m++)if(!h[l.tab[m]]){h[l.tab[m]]=!0;for(var u=g[l.tab[m]],q=0;q<u.tabs.length;q++)if(null!=u.tabs[q]){var t,p=u.tabs[q];if((!p.coverage||-1!=(t=f._lctf.coverageIndex(p.coverage,a)))&&1!=u.ltype&&2==u.ltype){var r;if(1==p.fmt)for(p=p.pairsets[t],k=0;k<p.length;k++)p[k].gid2==c&&(r=p[k]);else if(2==p.fmt){r=f.U._getGlyphClass(a,p.classDef1);var A=f.U._getGlyphClass(c,p.classDef2);r=p.matrix[r][A]}r&&r.val1&&r.val1[2]&&(d+=r.val1[2]);r&&r.val2&&r.val2[0]&&
(d+=r.val2[0])}}}}}b.kern&&(a=b.kern.glyph1.indexOf(a),-1!=a&&(c=b.kern.rval[a].glyph2.indexOf(c),-1!=c&&(d+=b.kern.rval[a].vals[c])));return d};f.U.stringToGlyphs=function(b,a){for(var c=[],d=0;d<a.length;d++)65535<(e=a.codePointAt(d))&&d++,c.push(f.U.codeToGlyph(b,e));for(d=0;d<a.length;d++){var e;if(2367==(e=a.codePointAt(d))){var g=c[d-1];c[d-1]=c[d];c[d]=g}65535<e&&d++}d=b.GSUB;if(null==d)return c;b=d.lookupList;d=d.featureList;e="rlig liga mset isol init fina medi half pres blws".split(" ");
g=[];for(var h=0;h<d.length;h++){var k=d[h];if(-1!=e.indexOf(k.tag))for(var l=0;l<k.tab.length;l++)if(!g[k.tab[l]]){g[k.tab[l]]=!0;for(var m=b[k.tab[l]],u=0;u<c.length;u++){var q=f.U._getWPfeature(a,u);-1!="isol,init,fina,medi".indexOf(k.tag)&&k.tag!=q||f.U._applySubs(c,u,m,b)}}}return c};f.U._getWPfeature=function(b,a){var c=0==a||-1!='\n\t" ,.:;!?()  \u060c'.indexOf(b[a-1]),d=a==b.length-1||-1!='\n\t" ,.:;!?()  \u060c'.indexOf(b[a+1]);c||-1=="\u0622\u0623\u0624\u0625\u0627\u0629\u062f\u0630\u0631\u0632\u0648\u0671\u0672\u0673\u0675\u0676\u0677\u0688\u0689\u068a\u068b\u068c\u068d\u068e\u068f\u0690\u0691\u0692\u0693\u0694\u0695\u0696\u0697\u0698\u0699\u06c0\u06c3\u06c4\u06c5\u06c6\u06c7\u06c8\u06c9\u06ca\u06cb\u06cd\u06cf\u06d2\u06d3\u06d5\u06ee\u06ef\u0710\u0715\u0716\u0717\u0718\u0719\u071e\u0728\u072a\u072c\u072f\u074d\u0759\u075a\u075b\u076b\u076c\u0771\u0773\u0774\u0778\u0779\u0840\u0846\u0847\u0849\u0854\u0867\u0869\u086a\u08aa\u08ab\u08ac\u08ae\u08b1\u08b2\u08b9\u0ac5\u0ac7\u0ac9\u0aca\u0ace\u0acf\u0ad0\u0ad1\u0ad2\u0add\u0ae1\u0ae4\u0aef\u0b81\u0b83\u0b84\u0b85\u0b89\u0b8c\u0b8e\u0b8f\u0b91\u0ba9\u0baa\u0bab\u0bac".indexOf(b[a-
1])||(c=!0);d||-1=="\u0622\u0623\u0624\u0625\u0627\u0629\u062f\u0630\u0631\u0632\u0648\u0671\u0672\u0673\u0675\u0676\u0677\u0688\u0689\u068a\u068b\u068c\u068d\u068e\u068f\u0690\u0691\u0692\u0693\u0694\u0695\u0696\u0697\u0698\u0699\u06c0\u06c3\u06c4\u06c5\u06c6\u06c7\u06c8\u06c9\u06ca\u06cb\u06cd\u06cf\u06d2\u06d3\u06d5\u06ee\u06ef\u0710\u0715\u0716\u0717\u0718\u0719\u071e\u0728\u072a\u072c\u072f\u074d\u0759\u075a\u075b\u076b\u076c\u0771\u0773\u0774\u0778\u0779\u0840\u0846\u0847\u0849\u0854\u0867\u0869\u086a\u08aa\u08ab\u08ac\u08ae\u08b1\u08b2\u08b9\u0ac5\u0ac7\u0ac9\u0aca\u0ace\u0acf\u0ad0\u0ad1\u0ad2\u0add\u0ae1\u0ae4\u0aef\u0b81\u0b83\u0b84\u0b85\u0b89\u0b8c\u0b8e\u0b8f\u0b91\u0ba9\u0baa\u0bab\u0bac".indexOf(b[a])||
(d=!0);d||-1=="\ua872\u0acd\u0ad7".indexOf(b[a+1])||(d=!0);c||-1=="\ua872\u0acd\u0ad7".indexOf(b[a])||(c=!0);return c?d?"isol":"init":d?"fina":"medi"};f.U._applySubs=function(b,a,c,d){for(var e=b.length-a-1,g=0;g<c.tabs.length;g++)if(null!=c.tabs[g]){var h,k=c.tabs[g];if(!k.coverage||-1!=(h=f._lctf.coverageIndex(k.coverage,b[a])))if(1==c.ltype)b[a],1==k.fmt?b[a]+=k.delta:b[a]=k.newg[h];else if(4==c.ltype)for(var l=k.vals[h],m=0;m<l.length;m++){var u=l[m];k=u.chain.length;if(!(k>e)){for(var q=!0,t=
0,p=0;p<k;p++){for(;-1==b[a+t+(1+p)];)t++;u.chain[p]!=b[a+t+(1+p)]&&(q=!1)}if(q){b[a]=u.nglyph;for(p=0;p<k+t;p++)b[a+p+1]=-1;break}}}else if(5==c.ltype&&2==k.fmt)for(l=f._lctf.getInterval(k.cDef,b[a]),t=k.scset[k.cDef[l+2]],u=0;u<t.length;u++){m=t[u];var r=m.input;if(!(r.length>e)){q=!0;for(p=0;p<r.length;p++){var A=f._lctf.getInterval(k.cDef,b[a+1+p]);if(-1==l&&k.cDef[A+2]!=r[p]){q=!1;break}}if(q)for(q=m.substLookupRecords,m=0;m<q.length;m+=2)q[m],q[m+1]}}else if(6==c.ltype&&3==k.fmt&&f.U._glsCovered(b,
k.backCvg,a-k.backCvg.length)&&f.U._glsCovered(b,k.inptCvg,a)&&f.U._glsCovered(b,k.ahedCvg,a+k.inptCvg.length))for(q=k.lookupRec,u=0;u<q.length;u+=2)l=q[u],f.U._applySubs(b,a+l,d[q[u+1]],d)}};f.U._glsCovered=function(b,a,c){for(var d=0;d<a.length;d++)if(-1==f._lctf.coverageIndex(a[d],b[c+d]))return!1;return!0};f.U.glyphsToPath=function(b,a,c){for(var d={cmds:[],crds:[]},e=0,g=0;g<a.length;g++){var h=a[g];if(-1!=h){for(var k=g<a.length-1&&-1!=a[g+1]?a[g+1]:0,l=f.U.glyphToPath(b,h),m=0;m<l.crds.length;m+=
2)d.crds.push(l.crds[m]+e),d.crds.push(l.crds[m+1]);c&&d.cmds.push(c);for(m=0;m<l.cmds.length;m++)d.cmds.push(l.cmds[m]);c&&d.cmds.push("X");e+=b.hmtx.aWidth[h];g<a.length-1&&(e+=f.U.getPairAdjustment(b,h,k))}}return d};f.U.pathToSVG=function(b,a){null==a&&(a=5);for(var c=[],d=0,e={M:2,L:2,Q:4,C:6},g=0;g<b.cmds.length;g++){var f=b.cmds[g],k=d+(e[f]?e[f]:0);for(c.push(f);d<k;)f=b.crds[d++],c.push(parseFloat(f.toFixed(a))+(d==k?"":" "))}return c.join("")};f.U.pathToContext=function(b,a){for(var c=0,
d=b.crds,e=0;e<b.cmds.length;e++){var g=b.cmds[e];"M"==g?(a.moveTo(d[c],d[c+1]),c+=2):"L"==g?(a.lineTo(d[c],d[c+1]),c+=2):"C"==g?(a.bezierCurveTo(d[c],d[c+1],d[c+2],d[c+3],d[c+4],d[c+5]),c+=6):"Q"==g?(a.quadraticCurveTo(d[c],d[c+1],d[c+2],d[c+3]),c+=4):"#"==g.charAt(0)?(a.beginPath(),a.fillStyle=g):"Z"==g?a.closePath():"X"==g&&a.fill()}};f.U.P={};f.U.P.moveTo=function(b,a,c){b.cmds.push("M");b.crds.push(a,c)};f.U.P.lineTo=function(b,a,c){b.cmds.push("L");b.crds.push(a,c)};f.U.P.curveTo=function(b,
a,c,d,e,g,f){b.cmds.push("C");b.crds.push(a,c,d,e,g,f)};f.U.P.qcurveTo=function(b,a,c,d,e){b.cmds.push("Q");b.crds.push(a,c,d,e)};f.U.P.closePath=function(b){b.cmds.push("Z")};f.U._drawCFF=function(b,a,c,d,e){for(var g=a.stack,h=a.nStems,k=a.haveWidth,l=a.width,m=a.open,u=0,q=a.x,t=a.y,p=0,r=0,A=0,x=0,n=0,D=0,y=0,w=0,z=0,I=0,J={val:0,size:0};u<b.length;){f.CFF.getCharString(b,u,J);var v=J.val;if(u+=J.size,"o1"==v||"o18"==v)0!=g.length%2&&!k&&(l=g.shift()+d.nominalWidthX),h+=g.length>>1,g.length=0,
k=!0;else if("o3"==v||"o23"==v)0!=g.length%2&&!k&&(l=g.shift()+d.nominalWidthX),h+=g.length>>1,g.length=0,k=!0;else if("o4"==v)1<g.length&&!k&&(l=g.shift()+d.nominalWidthX,k=!0),m&&f.U.P.closePath(e),t+=g.pop(),f.U.P.moveTo(e,q,t),m=!0;else if("o5"==v)for(;0<g.length;)q+=g.shift(),t+=g.shift(),f.U.P.lineTo(e,q,t);else if("o6"==v||"o7"==v){var E=g.length,C="o6"==v;for(v=0;v<E;v++){var F=g.shift();C?q+=F:t+=F;C=!C;f.U.P.lineTo(e,q,t)}}else if("o8"==v||"o24"==v){E=g.length;for(C=0;C+6<=E;)p=q+g.shift(),
r=t+g.shift(),A=p+g.shift(),x=r+g.shift(),q=A+g.shift(),t=x+g.shift(),f.U.P.curveTo(e,p,r,A,x,q,t),C+=6;"o24"==v&&(q+=g.shift(),t+=g.shift(),f.U.P.lineTo(e,q,t))}else{if("o11"==v)break;if("o1234"==v||"o1235"==v||"o1236"==v||"o1237"==v)"o1234"==v&&(r=t,A=(p=q+g.shift())+g.shift(),I=x=r+g.shift(),D=x,w=t,q=(y=(n=(z=A+g.shift())+g.shift())+g.shift())+g.shift(),f.U.P.curveTo(e,p,r,A,x,z,I),f.U.P.curveTo(e,n,D,y,w,q,t)),"o1235"==v&&(p=q+g.shift(),r=t+g.shift(),A=p+g.shift(),x=r+g.shift(),z=A+g.shift(),
I=x+g.shift(),n=z+g.shift(),D=I+g.shift(),y=n+g.shift(),w=D+g.shift(),q=y+g.shift(),t=w+g.shift(),g.shift(),f.U.P.curveTo(e,p,r,A,x,z,I),f.U.P.curveTo(e,n,D,y,w,q,t)),"o1236"==v&&(p=q+g.shift(),r=t+g.shift(),A=p+g.shift(),I=x=r+g.shift(),D=x,y=(n=(z=A+g.shift())+g.shift())+g.shift(),w=D+g.shift(),q=y+g.shift(),f.U.P.curveTo(e,p,r,A,x,z,I),f.U.P.curveTo(e,n,D,y,w,q,t)),"o1237"==v&&(p=q+g.shift(),r=t+g.shift(),A=p+g.shift(),x=r+g.shift(),z=A+g.shift(),I=x+g.shift(),n=z+g.shift(),D=I+g.shift(),y=n+g.shift(),
w=D+g.shift(),Math.abs(y-q)>Math.abs(w-t)?q=y+g.shift():t=w+g.shift(),f.U.P.curveTo(e,p,r,A,x,z,I),f.U.P.curveTo(e,n,D,y,w,q,t));else if("o14"==v){if(0<g.length&&!k&&(l=g.shift()+c.nominalWidthX,k=!0),4==g.length)E=g.shift(),C=g.shift(),F=g.shift(),v=g.shift(),F=f.CFF.glyphBySE(c,F),v=f.CFF.glyphBySE(c,v),f.U._drawCFF(c.CharStrings[F],a,c,d,e),a.x=E,a.y=C,f.U._drawCFF(c.CharStrings[v],a,c,d,e);m&&(f.U.P.closePath(e),m=!1)}else if("o19"==v||"o20"==v)0!=g.length%2&&!k&&(l=g.shift()+d.nominalWidthX),
h+=g.length>>1,g.length=0,k=!0,u+=h+7>>3;else if("o21"==v)2<g.length&&!k&&(l=g.shift()+d.nominalWidthX,k=!0),t+=g.pop(),q+=g.pop(),m&&f.U.P.closePath(e),f.U.P.moveTo(e,q,t),m=!0;else if("o22"==v)1<g.length&&!k&&(l=g.shift()+d.nominalWidthX,k=!0),q+=g.pop(),m&&f.U.P.closePath(e),f.U.P.moveTo(e,q,t),m=!0;else if("o25"==v){for(;6<g.length;)q+=g.shift(),t+=g.shift(),f.U.P.lineTo(e,q,t);p=q+g.shift();r=t+g.shift();A=p+g.shift();x=r+g.shift();q=A+g.shift();t=x+g.shift();f.U.P.curveTo(e,p,r,A,x,q,t)}else if("o26"==
v)for(g.length%2&&(q+=g.shift());0<g.length;)p=q,r=t+g.shift(),q=A=p+g.shift(),t=(x=r+g.shift())+g.shift(),f.U.P.curveTo(e,p,r,A,x,q,t);else if("o27"==v)for(g.length%2&&(t+=g.shift());0<g.length;)r=t,A=(p=q+g.shift())+g.shift(),x=r+g.shift(),q=A+g.shift(),t=x,f.U.P.curveTo(e,p,r,A,x,q,t);else if("o10"==v||"o29"==v)E="o10"==v?d:c,0==g.length?console.debug("error: empty stack"):(C=g.pop(),E=E.Subrs[C+E.Bias],a.x=q,a.y=t,a.nStems=h,a.haveWidth=k,a.width=l,a.open=m,f.U._drawCFF(E,a,c,d,e),q=a.x,t=a.y,
h=a.nStems,k=a.haveWidth,l=a.width,m=a.open);else if("o30"==v||"o31"==v)for(E=g.length,v=(C=0,"o31"==v),C+=E-(E&=-3);C<E;)v?(r=t,A=(p=q+g.shift())+g.shift(),t=(x=r+g.shift())+g.shift(),5==E-C?(q=A+g.shift(),C++):q=A,v=!1):(p=q,r=t+g.shift(),A=p+g.shift(),x=r+g.shift(),q=A+g.shift(),5==E-C?(t=x+g.shift(),C++):t=x,v=!0),f.U.P.curveTo(e,p,r,A,x,q,t),C+=4;else{if("o"==(v+"").charAt(0))throw console.debug("Unknown operation: "+v,b),v;g.push(v)}}}a.x=q;a.y=t;a.nStems=h;a.haveWidth=k;a.width=l;a.open=m};
var w=f,y={Typr:w};return n.Typr=w,n.default=y,n}({}).Typr},function(){return function(n){function f(){this.table=new Uint16Array(16);this.trans=new Uint16Array(288)}function w(a,b){this.source=a;this.bitcount=this.tag=this.sourceIndex=0;this.dest=b;this.destLen=0;this.ltree=new f;this.dtree=new f}function y(a,b,c,d){var e;for(e=0;e<c;++e)a[e]=0;for(e=0;e<30-c;++e)a[e+c]=e/c|0;c=d;for(e=0;30>e;++e)b[e]=c,c+=1<<a[e]}function b(a,b,c,d){var e,g;for(e=0;16>e;++e)a.table[e]=0;for(e=0;e<d;++e)a.table[b[c+
e]]++;for(e=g=a.table[0]=0;16>e;++e)p[e]=g,g+=a.table[e];for(e=0;e<d;++e)b[c+e]&&(a.trans[p[b[c+e]]++]=e)}function a(a,b,c){if(!b)return c;for(;24>a.bitcount;)a.tag|=a.source[a.sourceIndex++]<<a.bitcount,a.bitcount+=8;var d=a.tag&65535>>>16-b;return a.tag>>>=b,a.bitcount-=b,d+c}function c(a,b){for(;24>a.bitcount;)a.tag|=a.source[a.sourceIndex++]<<a.bitcount,a.bitcount+=8;var c=0,d=0,e=0,g=a.tag;do d=2*d+(1&g),g>>>=1,++e,c+=b.table[e],d-=b.table[e];while(0<=d);return a.tag=g,a.bitcount-=e,b.trans[c+
d]}function d(b,d,e){for(;;){var g;var f=c(b,d);if(256===f)return 0;if(256>f)b.dest[b.destLen++]=f;else{var p=a(b,h[f-=257],k[f]);f=c(b,e);for(g=f=b.destLen-a(b,l[f],m[f]);g<f+p;++g)b.dest[b.destLen++]=b.dest[g]}}}var e=new f,g=new f,h=new Uint8Array(30),k=new Uint16Array(30),l=new Uint8Array(30),m=new Uint16Array(30),u=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),q=new f,t=new Uint8Array(320),p=new Uint16Array(16);!function(a,b){var c;for(c=0;7>c;++c)a.table[c]=0;a.table[7]=24;
a.table[8]=152;a.table[9]=112;for(c=0;24>c;++c)a.trans[c]=256+c;for(c=0;144>c;++c)a.trans[24+c]=c;for(c=0;8>c;++c)a.trans[168+c]=280+c;for(c=0;112>c;++c)a.trans[176+c]=144+c;for(c=0;5>c;++c)b.table[c]=0;b.table[5]=32;for(c=0;32>c;++c)b.trans[c]=c}(e,g);y(h,k,4,3);y(l,m,2,1);h[28]=0;k[28]=258;return n.convert_streams=function(f){function h(){var a=l.getUint16(r);return r+=2,a}function k(){var a=l.getUint32(r);return r+=4,a}function p(a){oa.setUint16(H,a);H+=2}function m(a){oa.setUint32(H,a);H+=4}var l=
new DataView(f),r=0;k();var n=k();k();var y=h();h();k();h();h();k();k();k();k();k();for(var z=0;Math.pow(2,z)<=y;)z++;z--;for(var v=16*Math.pow(2,z),E=16*y-v,C=12,F=[],R=0;R<y;R++)F.push({tag:k(),offset:k(),compLength:k(),origLength:k(),origChecksum:k()}),C+=16;var B,aa=new Uint8Array(12+16*F.length+F.reduce(function(a,b){return a+b.origLength+4},0));R=aa.buffer;var oa=new DataView(R),H=0;return m(n),p(y),p(v),p(z),p(E),F.forEach(function(a){m(a.tag);m(a.origChecksum);m(C);m(a.origLength);a.outOffset=
C;0!=(C+=a.origLength)%4&&(C+=4-C%4)}),F.forEach(function(h){var k=f.slice(h.offset,h.offset+h.compLength);if(h.compLength!=h.origLength){var p=new Uint8Array(h.origLength);k=new Uint8Array(k,2);k=new w(k,p);do{var m=k;m.bitcount--||(m.tag=m.source[m.sourceIndex++],m.bitcount=7);var l=1&m.tag;switch(m=(m.tag>>>=1,l),a(k,2,0)){case 0:var r;for(l=k;8<l.bitcount;)l.sourceIndex--,l.bitcount-=8;if((r=256*(r=l.source[l.sourceIndex+1])+l.source[l.sourceIndex])!==(65535&~(256*l.source[l.sourceIndex+3]+l.source[l.sourceIndex+
2])))l=-3;else{for(l.sourceIndex+=4;r;--r)l.dest[l.destLen++]=l.source[l.sourceIndex++];l=(l.bitcount=0,0)}break;case 1:l=d(k,e,g);break;case 2:var n,A=k,x=k.ltree,y=k.dtree;r=a(A,5,257);l=a(A,5,1);var v=a(A,4,4);for(n=0;19>n;++n)t[n]=0;for(n=0;n<v;++n){var z=a(A,3,0);t[u[n]]=z}b(q,t,0,19);for(n=0;n<r+l;)switch(v=c(A,q),v){case 16:z=t[n-1];for(v=a(A,2,3);v;--v)t[n++]=z;break;case 17:for(v=a(A,3,3);v;--v)t[n++]=0;break;case 18:for(v=a(A,7,11);v;--v)t[n++]=0;break;default:t[n++]=v}b(x,t,0,r);b(y,t,
r,l);l=d(k,k.ltree,k.dtree);break;default:l=-3}if(0!==l)throw Error("Data error");}while(!m);k.destLen<k.dest.length&&("function"==typeof k.dest.slice?k.dest.slice(0,k.destLen):k.dest.subarray(0,k.destLen))}else p=new Uint8Array(k);aa.set(p,h.outOffset);p=0;0!=(C=h.outOffset+h.origLength)%4&&(p=4-C%4);aa.set((new Uint8Array(p)).buffer,h.outOffset+h.origLength);B=C+p}),R.slice(0,B)},n}({}).convert_streams},function(n,f){function w(b){var a=Object.create(null),c={unitsPerEm:b.head.unitsPerEm,ascender:b.hhea.ascender,
descender:b.hhea.descender,forEachGlyph:function(d,e,g,f){var h=0,l=1/c.unitsPerEm*e,m=0,u=-1;n.U.stringToGlyphs(b,d).forEach(function(c,k){if(-1!==c){k=a[c];if(!k){k=n.U.glyphToPath(b,c);var p=k.cmds,q=k.crds,t,x;if(q.length){k=t=Infinity;var w=x=-Infinity;for(var z=0,M=q.length;z<M;z+=2){var B=q[z],P=q[z+1];B<k&&(k=B);P<t&&(t=P);B>w&&(w=B);P>x&&(x=P)}}else k=w=t=x=0;k=a[c]={index:c,advanceWidth:b.hmtx.aWidth[c],xMin:k,yMin:t,xMax:w,yMax:x,pathCommandCount:p.length,forEachPathCommand:function(a){for(var b=
0,c=[],d=0,e=p.length;d<e;d++){var g=y[p[d]];c.length=1+g;c[0]=p[d];for(var f=1;f<=g;f++)c[f]=q[b++];a.apply(null,c)}}}}-1!==u&&(h+=n.U.getPairAdjustment(b,u,c)*l);f.call(null,k,h,m);k.advanceWidth&&(h+=k.advanceWidth*l);g&&(h+=g*e);u=c}m+=65535<d.codePointAt(m)?2:1});return h}};return c}var y={M:2,L:2,Q:4,C:6,Z:0};return function(b){var a=new Uint8Array(b,0,4);a=n._bin.readASCII(a,0,4);if("wOFF"===a)b=f(b);else if("wOF2"===a)throw Error("woff2 fonts not supported");return w(n.parse(b)[0])}}],init:function(n,
f,w){n=n();f=f();return w(n,f)}}),L={defaultFontURL:"https://fonts.gstatic.com/s/roboto/v18/KFOmCnqEu92Fr1Mu4mxM.woff",sdfGlyphSize:64,sdfMargin:.0625,sdfExponent:9,textureWidth:2048},sa=new z.Color,ja=!1,la=Object.create(null),U;S=H.defineWorkerModule({name:"FontProcessor",dependencies:[L,S,function(){function n(){f&&(w.sort(function(f,b){return f.maxX-b.maxX}),f=!1)}var f=!1,w=[];return{addLineSegment:function(n,b,a,c){w.push({x0:n,y0:b,x1:a,y1:c,minX:Math.min(n,a),minY:Math.min(b,c),maxX:Math.max(n,
a),maxY:Math.max(b,c)});f=!0},findNearestSignedDistance:function(f,b){n();for(var a=Infinity,c=Infinity,d=w.length;d--;){var e=w[d];if(e.maxX+c<=f)break;if(f+c>e.minX&&b-c<e.maxY&&b+c>e.minY){var g=e.x0;var h=e.y0;var k=e.x1-g;e=e.y1-h;var l=k*k+e*e;l=l?Math.max(0,Math.min(1,((f-g)*k+(b-h)*e)/l)):0;g=f-(g+l*k);h=b-(h+l*e);h=g*g+h*h;h<a&&(a=h,c=Math.sqrt(a))}}n();a=!1;for(d=w.length;d--;){h=w[d];if(h.maxX<=f)break;h.minY<b&&h.maxY>b&&h.y0>b!==h.y1>b&&f<(h.x1-h.x0)*(b-h.y0)/(h.y1-h.y0)+h.x0&&(a=!a)}a&&
(c=-c);return c}}},function(n,f){var w=f.sdfExponent,y=f.sdfMargin;return function(b,a){var c=new Uint8Array(a*a),d=b.xMax-b.xMin,e=b.yMax-b.yMin,g=Math.max(d,e),f=Math.max(d,e)/a*(y*a+.5);d=b.xMin-f;e=b.yMin-f;var k=b.xMax+f;f=b.yMax+f;var l=k-d,m=f-e,u=Math.max(l,m);if(b.pathCommandCount){var q=n(b),t,p,r,A;b.forEachPathCommand(function(a,b,c,d,e,g,f){switch(a){case "M":r=t=b;A=p=c;break;case "L":b===r&&c===A||q.addLineSegment(r,A,r=b,A=c);break;case "Q":g={x:r,y:A};for(f=1;16>f;f++){a=f/15;var h=
1-a;a={x:h*h*r+2*h*a*b+a*a*d,y:h*h*A+2*h*a*c+a*a*e};q.addLineSegment(g.x,g.y,a.x,a.y);g=a}r=d;A=e;break;case "C":a={x:r,y:A};for(h=1;16>h;h++){var k=h/15;var l=1-k;k={x:l*l*l*r+3*l*l*k*b+3*l*k*k*d+k*k*k*g,y:l*l*l*A+3*l*l*k*c+3*l*k*k*e+k*k*k*f};q.addLineSegment(a.x,a.y,k.x,k.y);a=k}r=g;A=f;break;case "Z":r===t&&A===p||q.addLineSegment(r,A,t,p)}});for(b=0;b<a;b++)for(var x=0;x<a;x++){var z=q.findNearestSignedDistance(d+l*(b+.5)/a,e+m*(x+.5)/a,g),D=Math.pow(1-Math.abs(z)/u,w)/2;0>z&&(D=1-D);D=Math.max(0,
Math.min(255,Math.round(255*D)));c[x*a+b]=D}}return{textureData:c,renderingBounds:[d,e,k,f]}}},function(n,f,w){function y(a,b){function c(){var d=function(b){console.error("Failure loading font "+a+(a===h?"":"; trying fallback"),b);a!==h&&(a=h,c())};try{var e=new XMLHttpRequest;e.open("get",a,!0);e.responseType="arraybuffer";e.onload=function(){if(400<=e.status)d(Error(e.statusText));else if(0<e.status)try{var a=n(e.response);b(a)}catch(A){d(A)}};e.onerror=d;e.send()}catch(r){d(r)}}c()}function b(a,
b){a||(a=h);var c=l[a];c?c.pending?c.pending.push(b):b(c):(l[a]={pending:[b]},y(a,function(b){var c=l[a].pending;l[a]=b;c.forEach(function(a){return a(b)})}))}function a(a,c,d){a||(a=h);var e=a+"@"+c,g=k[e];g?d(g):b(a,function(a){g=k[e]||(k[e]={fontObj:a,glyphs:{},glyphCount:0});d(g)})}function c(b,c,k){var l=b.text;void 0===l&&(l="");var p=b.font;void 0===p&&(p=h);var q=b.sdfGlyphSize;void 0===q&&(q=64);var m=b.fontSize;void 0===m&&(m=1);var n=b.letterSpacing;void 0===n&&(n=0);var u=b.lineHeight;
void 0===u&&(u="normal");var w=b.maxWidth;void 0===w&&(w=Infinity);var y=b.textAlign;void 0===y&&(y="left");var z=b.textIndent;void 0===z&&(z=0);var B=b.whiteSpace;void 0===B&&(B="normal");var I=b.overflowWrap;void 0===I&&(I="normal");var J=b.anchorX;void 0===J&&(J=0);var v=b.anchorY;void 0===v&&(v=0);var E=b.includeCaretPositions;void 0===E&&(E=!1);var C=b.chunkedBoundsSize;void 0===C&&(C=8192);var F=b.colorRanges;void 0===F&&(F=null);void 0===k&&(k=!1);var H=e(),N={total:0,fontLoad:0,layout:0,sdf:{},
sdfTotal:0};-1<l.indexOf("\r")&&(console.warn("FontProcessor.process: got text with \\r chars; normalizing to \\n"),l=l.replace(/\r\n/g,"\n").replace(/\r/g,"\n"));m=+m;n=+n;w=+w;u=u||"normal";z=+z;a(p,q,function(a){var b=a.fontObj,h=isFinite(w),p=null,r=null,t=null,A=null,x=null,D=null,Q=null,M=0,L=0,R="nowrap"!==B,V=b.ascender,W=b.descender,ba=b.unitsPerEm;N.fontLoad=e()-H;var U=e(),G=m/ba;"normal"===u&&(u=(V-W)/ba);u*=m;ba=(u-(V-W)*G)/2;var P=-(V*G+ba),S=Math.min(u,(V-W)*G),aa=(V+W)/2*G-S/2,X=z,
K=new g,Y=[K];b.forEachGlyph(l,m,n,function(a,b,c){var d=l.charAt(c),e=a.advanceWidth*G,f=K.count;"isEmpty"in a||(a.isWhitespace=!!d&&/\s/.test(d),a.isEmpty=a.xMin===a.xMax||a.yMin===a.yMax);a.isWhitespace||a.isEmpty||L++;if(R&&h&&!a.isWhitespace&&b+e+X>w&&f){if(K.glyphAt(f-1).glyphObj.isWhitespace){var k=new g;X=-b}else for(;f--;)if(0===f&&"break-word"===I){k=new g;X=-b;break}else if(K.glyphAt(f).glyphObj.isWhitespace){k=K.splitAt(f+1);f=k.glyphAt(0).x;X-=f;for(var p=k.count;p--;)k.glyphAt(p).x-=
f;break}k&&(K.isSoftWrapped=!0,K=k,Y.push(K),M=w)}k=K.glyphAt(K.count);k.glyphObj=a;k.x=b+X;k.width=e;k.charIndex=c;"\n"===d&&(K=new g,Y.push(K),X=-(b+e+n*m)+z)});Y.forEach(function(a){for(var b=a.count;b--;){var c=a.glyphAt(b),d=c.x,e=c.width;if(!c.glyphObj.isWhitespace){a.width=d+e;a.width>M&&(M=a.width);break}}});var T=0,Z=0;J&&("number"===typeof J?T=-J:"string"===typeof J&&(T=-M*("left"===J?0:"center"===J?.5:"right"===J?1:d(J))));v&&("number"===typeof v?Z=-v:"string"===typeof v&&(b=Y.length*u,
Z="top"===v?0:"top-baseline"===v?-P:"middle"===v?b/2:"bottom"===v?b:"bottom-baseline"===v?b-ba+W*G:d(v)*b));if(!k){r=new Float32Array(4*L);t=new Float32Array(L);D=[Infinity,Infinity,-Infinity,-Infinity];Q=[];var ia=P;E&&(x=new Float32Array(3*l.length));F&&(A=new Uint8Array(3*L));var ca=0,O=-1,ea=-1,fa,ha;Y.forEach(function(b){var c=b.count,d=b.width;if(0<c){var g=0,h=0;if("center"===y)g=(M-d)/2;else if("right"===y)g=M-d;else if("justify"===y&&b.isSoftWrapped){h=0;for(var k=c;k--;)if(!b.glyphAt(k).glyphObj.isWhitespace){for(;k--;){if(!b.glyphAt(k).glyphObj)debugger;
b.glyphAt(k).glyphObj.isWhitespace&&h++}break}h=(M-d)/h}for(d=0;d<c;d++){var m=b.glyphAt(d);k=m.glyphObj;g&&(m.x+=g);0!==h&&k.isWhitespace&&(g+=h,m.width+=h);if(E){var n=m.charIndex;x[3*n]=m.x+T;x[3*n+1]=m.x+m.width+T;for(x[3*n+2]=ia+aa+Z;1<n-O;)x[3*(O+1)]=x[3*O],x[3*(O+1)+1]=x[3*O+1],x[3*(O+1)+2]=x[3*O+2],O++;O=n}if(F)for(n=m.charIndex;n>ea;)ea++,F.hasOwnProperty(ea)&&(ha=F[ea]);if(!k.isWhitespace&&!k.isEmpty){n=ca++;var w=a.glyphs[k.index];if(!w){w=e();var v=f(k,q);N.sdf[l.charAt(m.charIndex)]=
e()-w;v.atlasIndex=a.glyphCount++;p||(p=[]);p.push(v);w=a.glyphs[k.index]={atlasIndex:v.atlasIndex,glyphObj:k,renderingBounds:v.renderingBounds}}v=w.renderingBounds;var z=4*n,B=m.x+T;m=ia+Z;r[z]=B+v[0]*G;r[z+1]=m+v[1]*G;r[z+2]=B+v[2]*G;r[z+3]=m+v[3]*G;v=B+k.xMin*G;z=m+k.yMin*G;B+=k.xMax*G;k=m+k.yMax*G;v<D[0]&&(D[0]=v);z<D[1]&&(D[1]=z);B>D[2]&&(D[2]=B);k>D[3]&&(D[3]=k);0===n%C&&(fa={start:n,end:n,rect:[Infinity,Infinity,-Infinity,-Infinity]},Q.push(fa));fa.end++;m=fa.rect;v<m[0]&&(m[0]=v);z<m[1]&&
(m[1]=z);B>m[2]&&(m[2]=B);k>m[3]&&(m[3]=k);t[n]=w.atlasIndex;F&&(k=3*n,A[k]=ha>>16&255,A[k+1]=ha>>8&255,A[k+2]=ha&255)}}}ia-=u})}for(var da in N.sdf)N.sdfTotal+=N.sdf[da];N.layout=e()-U-N.sdfTotal;N.total=e()-H;c({glyphBounds:r,glyphAtlasIndices:t,caretPositions:x,caretHeight:S,glyphColors:A,chunkedBounds:Q,ascender:V*G,descender:W*G,lineHeight:u,topBaseline:P,blockBounds:[T,Z-Y.length*u,T+M,Z],visibleBounds:D,newGlyphSDFs:p,timings:N})})}function d(a){a=(a=a.match(/^([\d.]+)%$/))?parseFloat(a[1]):
NaN;return isNaN(a)?0:a/100}function e(){return(self.performance||Date).now()}function g(){this.data=[]}var h=w.defaultFontURL,k=Object.create(null),l=Object.create(null);g.prototype={width:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/4)},glyphAt:function(a){var b=g.flyweight;b.data=this.data;b.index=a;return b},splitAt:function(a){var b=new g;b.data=this.data.splice(4*a);return b}};g.flyweight=["glyphObj","x","width","charIndex"].reduce(function(a,b,c,d){Object.defineProperty(a,
b,{get:function(){return this.data[4*this.index+c]},set:function(a){this.data[4*this.index+c]=a}});return a},{data:null,index:0});return{process:c,measure:function(a,b){c(a,function(a){a=a.blockBounds;b({width:a[2]-a[0],height:a[3]-a[1]})},{metricsOnly:!0})},loadFont:b}}],init:function(n,f,w,y,b){var a=n.defaultFontURL;n=y(w,{sdfExponent:n.sdfExponent,sdfMargin:n.sdfMargin});return b(f,n,{defaultFontURL:a})}});var ta=H.defineWorkerModule({name:"TextBuilder",dependencies:[S,H.ThenableWorkerModule],
init:function(n,f){return function(w){var y=new f;n.process(w,y.resolve);return y}},getTransferables:function(n){var f=[n.glyphBounds.buffer,n.glyphAtlasIndices.buffer];n.caretPositions&&f.push(n.caretPositions.buffer);n.newGlyphSDFs&&n.newGlyphSDFs.forEach(function(n){f.push(n.textureData.buffer)});return f}}),pa=function(){function n(a){var b=y[a];b||(b=y[a]=(new z.PlaneBufferGeometry(1,1,a,a)).translate(.5,.5,0));return b}function f(a,b,e,g){var c=a.getAttribute(b);e?c&&c.array.length===e.length?
(c.array.set(e),c.needsUpdate=!0):(a.setAttribute(b,new z.InstancedBufferAttribute(e,g)),delete a._maxInstanceCount,a.dispose()):c&&a.deleteAttribute(b)}function w(a,b){a[a.hasOwnProperty("instanceCount")?"instanceCount":"maxInstancedCount"]=b}var y={},b=new z.Vector3,a=function(a){function c(){a.call(this);this.detail=1;this.groups=[{start:0,count:Infinity,materialIndex:0},{start:0,count:Infinity,materialIndex:1}];this.boundingSphere=new z.Sphere;this.boundingBox=new z.Box3}a&&(c.__proto__=a);c.prototype=
Object.create(a&&a.prototype);c.prototype.constructor=c;var e={detail:{configurable:!0}};c.prototype.computeBoundingSphere=function(){};c.prototype.computeBoundingBox=function(){};e.detail.set=function(a){var b=this;if(a!==this._detail){this._detail=a;if("number"!==typeof a||1>a)a=1;var c=n(a);["position","normal","uv"].forEach(function(a){b.attributes[a]=c.attributes[a].clone()});this.setIndex(c.getIndex().clone())}};e.detail.get=function(){return this._detail};c.prototype.updateGlyphs=function(a,
c,d,e,m){f(this,"aTroikaGlyphBounds",a,4);f(this,"aTroikaGlyphIndex",c,1);f(this,"aTroikaGlyphColor",m,3);this._chunkedBounds=e;w(this,c.length);a=this.boundingSphere;a.center.set((d[0]+d[2])/2,(d[1]+d[3])/2,0);a.radius=a.center.distanceTo(b.set(d[0],d[1],0));a=this.boundingBox;a.min.set(d[0],d[1],0);a.max.set(d[2],d[3],0)};c.prototype.applyClipRect=function(a){var b=this.getAttribute("aTroikaGlyphIndex").count,c=this._chunkedBounds;if(c)for(var d=c.length;d--;){b=c[d].end;var e=c[d].rect;if(e[1]<
a.w&&e[3]>a.y&&e[0]<a.z&&e[2]>a.x)break}w(this,b)};Object.defineProperties(c.prototype,e);return c}(z.InstancedBufferGeometry);a.prototype.setAttribute||(a.prototype.setAttribute=function(a,b){this.attributes[a]=b;return this});return a}();H=function(){function n(a){return Array.isArray(a)?a[0]:a}var f=new z.MeshBasicMaterial({color:16777215,side:z.DoubleSide,transparent:!0}),w=new z.Matrix4,y=new z.Vector3,b=new z.Vector3,a=[],c=new z.Vector3,d=new z.Mesh((new z.PlaneBufferGeometry(1,1)).translate(.5,
.5,0),f),e={type:"syncstart"},g={type:"synccomplete"},h="font fontSize letterSpacing lineHeight maxWidth overflowWrap text textAlign textIndent whiteSpace anchorX anchorY colorRanges sdfGlyphSize".split(" "),k=h.concat("material","color","depthOffset","clipRect","orientation","glyphGeometryDetail"),l=function(h){function l(){var a=new pa;h.call(this,a,null);this.text="";this.anchorY=this.anchorX=0;this.font=null;this.fontSize=.1;this.letterSpacing=0;this.lineHeight="normal";this.maxWidth=Infinity;
this.overflowWrap="normal";this.textAlign="left";this.textIndent=0;this.whiteSpace="normal";this.colorRanges=this.color=this.material=null;this.depthOffset=this.outlineColor=this.outlineWidth=0;this.clipRect=null;this.orientation="+x+y";this.glyphGeometryDetail=1;this.sdfGlyphSize=null;this.debugSDF=!1}h&&(l.__proto__=h);l.prototype=Object.create(h&&h.prototype);l.prototype.constructor=l;var m={textRenderInfo:{configurable:!0},material:{configurable:!0},glyphGeometryDetail:{configurable:!0},customDepthMaterial:{configurable:!0},
customDistanceMaterial:{configurable:!0}};l.prototype.sync=function(a){var b=this;this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(a):(this._isSyncing=!0,this.dispatchEvent(e),da({text:this.text,font:this.font,fontSize:this.fontSize||.1,letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,
anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize},function(c){b._isSyncing=!1;b._textRenderInfo=c;b.geometry.updateGlyphs(c.glyphBounds,c.glyphAtlasIndices,c.blockBounds,c.chunkedBounds,c.glyphColors);var d=b._queuedSyncs;d&&(b._queuedSyncs=null,b._needsSync=!0,b.sync(function(){d.forEach(function(a){return a&&a()})}));b.dispatchEvent(g);a&&a()})))};l.prototype.onBeforeRender=function(a,b,c,d,e,f){this.sync();e.isTroikaTextMaterial&&this._prepareForRender(e)};
l.prototype.dispose=function(){this.geometry.dispose()};m.textRenderInfo.get=function(){return this._textRenderInfo||null};m.material.get=function(){var a=this._derivedMaterial,b=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=f.clone());a&&a.baseMaterial===b||(a=this._derivedMaterial=ma(b),b.addEventListener("dispose",function Q(){b.removeEventListener("dispose",Q);a.dispose()}));if(this.outlineWidth){var c=a._outlineMtl;c||(c=a._outlineMtl=Object.create(a,{id:{value:a.id+.1}}),
c.isTextOutlineMaterial=!0,c.depthWrite=!1,c.map=null,a.addEventListener("dispose",function Q(){a.removeEventListener("dispose",Q);c.dispose()}));return[c,a]}return a};m.material.set=function(a){a&&a.isTroikaTextMaterial?(this._derivedMaterial=a,this._baseMaterial=a.baseMaterial):this._baseMaterial=a};m.glyphGeometryDetail.get=function(){return this.geometry.detail};m.glyphGeometryDetail.set=function(a){this.geometry.detail=a};m.customDepthMaterial.get=function(){return n(this.material).getDepthMaterial()};
m.customDistanceMaterial.get=function(){return n(this.material).getDistanceMaterial()};l.prototype._prepareForRender=function(a){var d=a.isTextOutlineMaterial,e=a.uniforms,f=this.textRenderInfo;if(f){var g=f.sdfTexture,h=f.blockBounds;e.uTroikaSDFTexture.value=g;e.uTroikaSDFTextureSize.value.set(g.image.width,g.image.height);e.uTroikaSDFGlyphSize.value=f.sdfGlyphSize;e.uTroikaSDFExponent.value=f.sdfExponent;e.uTroikaTotalBounds.value.fromArray(h);e.uTroikaUseGlyphColors.value=!!f.glyphColors;f=0;
d&&(f=this.outlineWidth,"string"===typeof f&&(f=(f=f.match(/^([\d.]+)%$/))?parseFloat(f[1]):NaN,f=(isNaN(f)?0:f/100)*this.fontSize));e.uTroikaDistanceOffset.value=f;(f=this.clipRect)&&Array.isArray(f)&&4===f.length?e.uTroikaClipRect.value.fromArray(f):(f=100*(this.fontSize||.1),e.uTroikaClipRect.value.set(h[0]-f,h[1]-f,h[2]+f,h[3]+f));this.geometry.applyClipRect(e.uTroikaClipRect.value)}e.uTroikaSDFDebug.value=!!this.debugSDF;a.polygonOffset=!!this.depthOffset;a.polygonOffsetFactor=a.polygonOffsetUnits=
this.depthOffset||0;d=d?this.outlineColor||0:this.color;null==d?delete a.color:(h=a.hasOwnProperty("color")?a.color:a.color=new z.Color,(d!==h._input||"object"===typeof d)&&h.set(h._input=d));d=this.orientation||"+x+y";if(d!==a._orientation){e=e.uTroikaOrient.value;d=d.replace(/[^-+xyz]/g,"");var k="+x+y"!==d&&d.match(/^([-+])([xyz])([-+])([xyz])$/);k?(h=k[1],f=k[2],g=k[3],k=k[4],y.set(0,0,0)[f]="-"===h?1:-1,b.set(0,0,0)[k]="-"===g?-1:1,w.lookAt(c,y.cross(b),b),e.setFromMatrix4(w)):e.identity();a._orientation=
d}};l.prototype.raycast=function(b,c){var e=this.textRenderInfo;if(e)for(e=e.blockBounds,d.matrixWorld.multiplyMatrices(this.matrixWorld,w.set(e[2]-e[0],0,0,e[0],0,e[3]-e[1],0,e[1],0,0,1,0,0,0,0,1)),a.length=0,d.raycast(b,a),b=0;b<a.length;b++)a[b].object=this,c.push(a[b])};l.prototype.copy=function(a){var b=this;h.prototype.copy.call(this,a);k.forEach(function(c){b[c]=a[c]});return this};l.prototype.clone=function(){return(new this.constructor).copy(this)};Object.defineProperties(l.prototype,m);
return l}(z.Mesh);h.forEach(function(a){var b="_private_"+a;Object.defineProperty(l.prototype,a,{get:function(){return this[b]},set:function(a){a!==this[b]&&(this[b]=a,this._needsSync=!0)}})});var m=!1;Object.defineProperty(l.prototype,"anchor",{get:function(){return this._deprecated_anchor},set:function(a){this._deprecated_anchor=a;m||(console.warn("TextMesh: `anchor` has been deprecated; use `anchorX` and `anchorY` instead."),m=!0);Array.isArray(a)?(this.anchorX=100*(+a[0]||0)+"%",this.anchorY=
100*(+a[1]||0)+"%"):this.anchorX=this.anchorY=0}});return l}();var qa=new WeakMap,na=new WeakMap;B.GlyphsGeometry=pa;B.Text=H;B.configureTextBuilder=function(n){ja?console.warn("configureTextBuilder called after first font request; will be ignored."):ka(L,n)};B.createTextDerivedMaterial=ma;B.fontProcessorWorkerModule=S;B.getCaretAtPoint=function(n,f,w){var y=null,b=n.caretHeight;n=ua(n);var a=Infinity;n.forEach(function(c,d){Math.abs(w-(d+b/2))<Math.abs(w-(a+b/2))&&(a=d)});n.get(a).forEach(function(a){if(!y||
Math.abs(f-a.x)<Math.abs(f-y.x))y=a});return y};B.getSelectionRects=function(n,f,w){if(n){var y=qa.get(n);if(y&&y.start===f&&y.end===w)return y.rects;y=n.caretPositions;var b=n.caretHeight,a=n.blockBounds;if(w<f){var c=f;f=w;w=c}f=Math.max(f,0);w=Math.min(w,y.length+1);c=new Map;for(var d=f;d<w;d++){var e=y[3*d],g=y[3*d+1],h=y[3*d+2],k=c.get(h);k?(k.left=Math.max(Math.min(k.left,e),a[0]),k.right=Math.min(Math.max(k.right,g),a[2])):(k={left:e,right:g,bottom:h,top:h+b},c.set(h,k))}var l=[];c.forEach(function(a){l.push(a)});
qa.set(n,{start:f,end:w,rects:l})}return l};B.preloadFont=function(n,f){var w=n.font,y=n.characters;n=n.sdfGlyphSize;y=Array.isArray(y)?y.join("\n"):""+y;da({font:w,sdfGlyphSize:n,text:y},f)};Object.defineProperty(B,"__esModule",{value:!0})})
